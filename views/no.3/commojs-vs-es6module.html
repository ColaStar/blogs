<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>模块规范对比 | 个人博客</title>
    <meta name="description" content="白云一片去悠悠，青枫浦上不胜愁。">
    <link rel="icon" href="https://colastar.github.io/blogs/views/images/favicon.ico">
  <link rel="manifest" href="https://colastar.github.io/blogs/views/js/manifest.json">
  <link rel="apple-touch-icon" href="https://colastar.github.io/blogs/views/images/logo.png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://colastar.github.io/blogs/views/js/tj.js"></script>
  <script src="https://colastar.github.io/blogs/views/js/code.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    
    <link rel="preload" href="/blogs/views/assets/css/0.styles.16aae78f.css" as="style"><link rel="preload" href="/blogs/views/assets/js/app.8e869d74.js" as="script"><link rel="preload" href="/blogs/views/assets/js/2.d340cefd.js" as="script"><link rel="preload" href="/blogs/views/assets/js/56.e471bc3a.js" as="script"><link rel="prefetch" href="/blogs/views/assets/js/10.1a72f1e6.js"><link rel="prefetch" href="/blogs/views/assets/js/100.3194571b.js"><link rel="prefetch" href="/blogs/views/assets/js/101.bbd09248.js"><link rel="prefetch" href="/blogs/views/assets/js/102.d4d6e327.js"><link rel="prefetch" href="/blogs/views/assets/js/103.a185cc2b.js"><link rel="prefetch" href="/blogs/views/assets/js/104.0d44dac3.js"><link rel="prefetch" href="/blogs/views/assets/js/105.0eeac3a3.js"><link rel="prefetch" href="/blogs/views/assets/js/106.50e6a1d7.js"><link rel="prefetch" href="/blogs/views/assets/js/107.874eba85.js"><link rel="prefetch" href="/blogs/views/assets/js/108.c2614d02.js"><link rel="prefetch" href="/blogs/views/assets/js/109.82fcb80b.js"><link rel="prefetch" href="/blogs/views/assets/js/11.7eb50028.js"><link rel="prefetch" href="/blogs/views/assets/js/110.f68276ee.js"><link rel="prefetch" href="/blogs/views/assets/js/111.a9f3112c.js"><link rel="prefetch" href="/blogs/views/assets/js/112.8cdee2a6.js"><link rel="prefetch" href="/blogs/views/assets/js/113.1610f4a0.js"><link rel="prefetch" href="/blogs/views/assets/js/114.231ccb47.js"><link rel="prefetch" href="/blogs/views/assets/js/115.007a509f.js"><link rel="prefetch" href="/blogs/views/assets/js/116.2a36ef4f.js"><link rel="prefetch" href="/blogs/views/assets/js/117.81b0677b.js"><link rel="prefetch" href="/blogs/views/assets/js/118.32428e42.js"><link rel="prefetch" href="/blogs/views/assets/js/119.eb7e00e0.js"><link rel="prefetch" href="/blogs/views/assets/js/12.053a299a.js"><link rel="prefetch" href="/blogs/views/assets/js/120.118da710.js"><link rel="prefetch" href="/blogs/views/assets/js/121.60317bf1.js"><link rel="prefetch" href="/blogs/views/assets/js/122.bc24c80f.js"><link rel="prefetch" href="/blogs/views/assets/js/123.1dbc0243.js"><link rel="prefetch" href="/blogs/views/assets/js/124.3b0e141e.js"><link rel="prefetch" href="/blogs/views/assets/js/125.44e7d0e1.js"><link rel="prefetch" href="/blogs/views/assets/js/126.50f00f88.js"><link rel="prefetch" href="/blogs/views/assets/js/127.86d487d6.js"><link rel="prefetch" href="/blogs/views/assets/js/128.62e8f2db.js"><link rel="prefetch" href="/blogs/views/assets/js/129.6fef2bec.js"><link rel="prefetch" href="/blogs/views/assets/js/13.7a6ddf7f.js"><link rel="prefetch" href="/blogs/views/assets/js/130.d6342e66.js"><link rel="prefetch" href="/blogs/views/assets/js/131.eea09277.js"><link rel="prefetch" href="/blogs/views/assets/js/132.dc893195.js"><link rel="prefetch" href="/blogs/views/assets/js/133.865f308e.js"><link rel="prefetch" href="/blogs/views/assets/js/134.76675d93.js"><link rel="prefetch" href="/blogs/views/assets/js/135.1296360f.js"><link rel="prefetch" href="/blogs/views/assets/js/136.6fbd3fff.js"><link rel="prefetch" href="/blogs/views/assets/js/137.799a876e.js"><link rel="prefetch" href="/blogs/views/assets/js/138.b9c69e1b.js"><link rel="prefetch" href="/blogs/views/assets/js/139.4d66ba94.js"><link rel="prefetch" href="/blogs/views/assets/js/14.64a2044f.js"><link rel="prefetch" href="/blogs/views/assets/js/140.af0e5ed1.js"><link rel="prefetch" href="/blogs/views/assets/js/141.51149e45.js"><link rel="prefetch" href="/blogs/views/assets/js/142.582270b8.js"><link rel="prefetch" href="/blogs/views/assets/js/143.7d018666.js"><link rel="prefetch" href="/blogs/views/assets/js/15.a21c9fa9.js"><link rel="prefetch" href="/blogs/views/assets/js/16.a44f9224.js"><link rel="prefetch" href="/blogs/views/assets/js/17.25867c79.js"><link rel="prefetch" href="/blogs/views/assets/js/18.9417f252.js"><link rel="prefetch" href="/blogs/views/assets/js/19.cb90520d.js"><link rel="prefetch" href="/blogs/views/assets/js/20.ec4b0a60.js"><link rel="prefetch" href="/blogs/views/assets/js/21.4774c21f.js"><link rel="prefetch" href="/blogs/views/assets/js/22.1ceea7e3.js"><link rel="prefetch" href="/blogs/views/assets/js/23.748bc1f0.js"><link rel="prefetch" href="/blogs/views/assets/js/24.96899d90.js"><link rel="prefetch" href="/blogs/views/assets/js/25.88c7e4df.js"><link rel="prefetch" href="/blogs/views/assets/js/26.807690a3.js"><link rel="prefetch" href="/blogs/views/assets/js/27.bf672bb7.js"><link rel="prefetch" href="/blogs/views/assets/js/28.c1d17c20.js"><link rel="prefetch" href="/blogs/views/assets/js/29.ee363daf.js"><link rel="prefetch" href="/blogs/views/assets/js/3.d1743aad.js"><link rel="prefetch" href="/blogs/views/assets/js/30.c06a5b7a.js"><link rel="prefetch" href="/blogs/views/assets/js/31.0699d199.js"><link rel="prefetch" href="/blogs/views/assets/js/32.6ffac1aa.js"><link rel="prefetch" href="/blogs/views/assets/js/33.1695ddf9.js"><link rel="prefetch" href="/blogs/views/assets/js/34.3ddda42f.js"><link rel="prefetch" href="/blogs/views/assets/js/35.488d063b.js"><link rel="prefetch" href="/blogs/views/assets/js/36.ade93422.js"><link rel="prefetch" href="/blogs/views/assets/js/37.b4ede68b.js"><link rel="prefetch" href="/blogs/views/assets/js/38.2bdd656f.js"><link rel="prefetch" href="/blogs/views/assets/js/39.f1a9a8e9.js"><link rel="prefetch" href="/blogs/views/assets/js/4.4e0deb20.js"><link rel="prefetch" href="/blogs/views/assets/js/40.4668d736.js"><link rel="prefetch" href="/blogs/views/assets/js/41.405fb6b6.js"><link rel="prefetch" href="/blogs/views/assets/js/42.1bda99d9.js"><link rel="prefetch" href="/blogs/views/assets/js/43.c68d17a4.js"><link rel="prefetch" href="/blogs/views/assets/js/44.d462bad3.js"><link rel="prefetch" href="/blogs/views/assets/js/45.59254ac0.js"><link rel="prefetch" href="/blogs/views/assets/js/46.4f08518f.js"><link rel="prefetch" href="/blogs/views/assets/js/47.3fd7d93b.js"><link rel="prefetch" href="/blogs/views/assets/js/48.ad2743c2.js"><link rel="prefetch" href="/blogs/views/assets/js/49.96cf687d.js"><link rel="prefetch" href="/blogs/views/assets/js/5.829db2fd.js"><link rel="prefetch" href="/blogs/views/assets/js/50.16133866.js"><link rel="prefetch" href="/blogs/views/assets/js/51.3980d2db.js"><link rel="prefetch" href="/blogs/views/assets/js/52.44143685.js"><link rel="prefetch" href="/blogs/views/assets/js/53.9305f94d.js"><link rel="prefetch" href="/blogs/views/assets/js/54.94f2c26b.js"><link rel="prefetch" href="/blogs/views/assets/js/55.be684606.js"><link rel="prefetch" href="/blogs/views/assets/js/57.06090e06.js"><link rel="prefetch" href="/blogs/views/assets/js/58.39fed49d.js"><link rel="prefetch" href="/blogs/views/assets/js/59.455b80b9.js"><link rel="prefetch" href="/blogs/views/assets/js/6.9b4144c4.js"><link rel="prefetch" href="/blogs/views/assets/js/60.395193e0.js"><link rel="prefetch" href="/blogs/views/assets/js/61.1b7d7ba1.js"><link rel="prefetch" href="/blogs/views/assets/js/62.99f52cbf.js"><link rel="prefetch" href="/blogs/views/assets/js/63.4ebd23d6.js"><link rel="prefetch" href="/blogs/views/assets/js/64.076fb2d7.js"><link rel="prefetch" href="/blogs/views/assets/js/65.a77ff8df.js"><link rel="prefetch" href="/blogs/views/assets/js/66.c47af622.js"><link rel="prefetch" href="/blogs/views/assets/js/67.2c379945.js"><link rel="prefetch" href="/blogs/views/assets/js/68.41d576fc.js"><link rel="prefetch" href="/blogs/views/assets/js/69.45e059df.js"><link rel="prefetch" href="/blogs/views/assets/js/7.5dd94ae7.js"><link rel="prefetch" href="/blogs/views/assets/js/70.81c48453.js"><link rel="prefetch" href="/blogs/views/assets/js/71.72192f41.js"><link rel="prefetch" href="/blogs/views/assets/js/72.21d87c42.js"><link rel="prefetch" href="/blogs/views/assets/js/73.0f6b1978.js"><link rel="prefetch" href="/blogs/views/assets/js/74.515cab07.js"><link rel="prefetch" href="/blogs/views/assets/js/75.ae0f2492.js"><link rel="prefetch" href="/blogs/views/assets/js/76.6d3111ea.js"><link rel="prefetch" href="/blogs/views/assets/js/77.228de8e4.js"><link rel="prefetch" href="/blogs/views/assets/js/78.c087a666.js"><link rel="prefetch" href="/blogs/views/assets/js/79.6dc91b07.js"><link rel="prefetch" href="/blogs/views/assets/js/8.666747ee.js"><link rel="prefetch" href="/blogs/views/assets/js/80.39dc430f.js"><link rel="prefetch" href="/blogs/views/assets/js/81.455cc06d.js"><link rel="prefetch" href="/blogs/views/assets/js/82.5a5723e9.js"><link rel="prefetch" href="/blogs/views/assets/js/83.6e21b82b.js"><link rel="prefetch" href="/blogs/views/assets/js/84.969b4f61.js"><link rel="prefetch" href="/blogs/views/assets/js/85.0d6fdaf3.js"><link rel="prefetch" href="/blogs/views/assets/js/86.aa8119ea.js"><link rel="prefetch" href="/blogs/views/assets/js/87.f240f80f.js"><link rel="prefetch" href="/blogs/views/assets/js/88.f6e600df.js"><link rel="prefetch" href="/blogs/views/assets/js/89.6a596777.js"><link rel="prefetch" href="/blogs/views/assets/js/9.a65832bd.js"><link rel="prefetch" href="/blogs/views/assets/js/90.f82f0a2e.js"><link rel="prefetch" href="/blogs/views/assets/js/91.7ec1aaac.js"><link rel="prefetch" href="/blogs/views/assets/js/92.e4c218c8.js"><link rel="prefetch" href="/blogs/views/assets/js/93.dea56057.js"><link rel="prefetch" href="/blogs/views/assets/js/94.5c8a85e3.js"><link rel="prefetch" href="/blogs/views/assets/js/95.d8e49d1a.js"><link rel="prefetch" href="/blogs/views/assets/js/96.d2f599f4.js"><link rel="prefetch" href="/blogs/views/assets/js/97.b7213047.js"><link rel="prefetch" href="/blogs/views/assets/js/98.bb7dc460.js"><link rel="prefetch" href="/blogs/views/assets/js/99.22abeebf.js">
    <link rel="stylesheet" href="/blogs/views/assets/css/0.styles.16aae78f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blogs/views/" class="home-link router-link-active"><!----> <span class="site-name">个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blogs/views/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/views/no.0/js/es6.html" class="nav-link">前端基础</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/javascript-QA/javascriptqa.html" class="nav-link">javaScript与测试工程师</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.1/函数式编程/函数式编程.html" class="nav-link">编程相关</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.2/http.html" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.3/webpack.html" class="nav-link">前端自动化</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.4/前端性能优化.html" class="nav-link">前端优化</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.5/css工作流.html" class="nav-link">css相关</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.6/react/react.html" class="nav-link">框架相关</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.7/计算机组成原理.html" class="nav-link">计算机组成原理</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.8/数据结构与算法.html" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/node/node/node.html" class="nav-link">node相关</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.10/网络安全.html" class="nav-link">网络安全</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/other/git/git命令全集.html" class="nav-link">其他相关</a></li></ul></div></div><div class="nav-item"><a href="/blogs/views/no.1/" class="nav-link">面试</a></div><div class="nav-item"><a href="https://github.com/ColaStar/blogs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blogs/views/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/views/no.0/js/es6.html" class="nav-link">前端基础</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/javascript-QA/javascriptqa.html" class="nav-link">javaScript与测试工程师</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.1/函数式编程/函数式编程.html" class="nav-link">编程相关</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.2/http.html" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.3/webpack.html" class="nav-link">前端自动化</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.4/前端性能优化.html" class="nav-link">前端优化</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.5/css工作流.html" class="nav-link">css相关</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.6/react/react.html" class="nav-link">框架相关</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.7/计算机组成原理.html" class="nav-link">计算机组成原理</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.8/数据结构与算法.html" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/node/node/node.html" class="nav-link">node相关</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.10/网络安全.html" class="nav-link">网络安全</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/other/git/git命令全集.html" class="nav-link">其他相关</a></li></ul></div></div><div class="nav-item"><a href="/blogs/views/no.1/" class="nav-link">面试</a></div><div class="nav-item"><a href="https://github.com/ColaStar/blogs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blogs/views/no.3/bower.html" class="sidebar-link">bower</a></li><li><a href="/blogs/views/no.3/browserify.html" class="sidebar-link">Browserify</a></li><li><a href="/blogs/views/no.3/commojs-vs-es6module.html" class="active sidebar-link">模块规范对比</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#深入-commonjs-与-es6-module" class="sidebar-link">深入 CommonJs 与 ES6 Module</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#模块化的发展" class="sidebar-link">模块化的发展</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#commonjs" class="sidebar-link">CommonJs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#模块导出" class="sidebar-link">模块导出</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#模块导入" class="sidebar-link">模块导入</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#循环引用" class="sidebar-link">循环引用</a></li></ul></li><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#amd" class="sidebar-link">AMD</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#cmd" class="sidebar-link">CMD</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#umd-模块（通用模块）" class="sidebar-link">umd 模块（通用模块）</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#es6-module" class="sidebar-link">es6 module</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#es6-module-基本语法：" class="sidebar-link">es6 module 基本语法：</a></li></ul></li><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#commonjs-和-es6-module-的区别" class="sidebar-link">CommonJs 和 ES6 Module 的区别</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#模块语法与解构" class="sidebar-link">模块语法与解构</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#es6-module-支持-commonjs-情况" class="sidebar-link">ES6 module 支持 CommonJs 情况</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#nodejs中使用" class="sidebar-link">Nodejs中使用</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#webpack中使用" class="sidebar-link">webpack中使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#rollup中使用" class="sidebar-link">rollup中使用</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#tree-shaking" class="sidebar-link">Tree-shaking</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#pkg-module" class="sidebar-link">pkg.module</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.3/commojs-vs-es6module.html#参考链接" class="sidebar-link">参考链接</a></li></ul></li><li><a href="/blogs/views/no.3/grunt.html" class="sidebar-link">grunt</a></li><li><a href="/blogs/views/no.3/gulp.html" class="sidebar-link">gulp</a></li><li><a href="/blogs/views/no.3/jenkins.html" class="sidebar-link">jenkins</a></li><li><a href="/blogs/views/no.3/linux_sed_awk.html" class="sidebar-link">sed与awk</a></li><li><a href="/blogs/views/no.3/linux防火墙.html" class="sidebar-link">linux防火墙</a></li><li><a href="/blogs/views/no.3/nginx-error.html" class="sidebar-link">centos错误集合</a></li><li><a href="/blogs/views/no.3/parcel.html" class="sidebar-link">parcel</a></li><li><a href="/blogs/views/no.3/pm2指南.html" class="sidebar-link">PM2</a></li><li><a href="/blogs/views/no.3/rollup.html" class="sidebar-link">rollup</a></li><li><a href="/blogs/views/no.3/webpack.html" class="sidebar-link">webpack</a></li><li><a href="/blogs/views/no.3/yeoman.html" class="sidebar-link">yeoman</a></li><li><a href="/blogs/views/no.3/免密登陆.html" class="sidebar-link">免密登陆</a></li><li><a href="/blogs/views/no.3/文件操作权限.html" class="sidebar-link">Linux权限</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="模块规范对比"><a href="#模块规范对比" aria-hidden="true" class="header-anchor">#</a> 模块规范对比</h1> <h2 id="深入-commonjs-与-es6-module"><a href="#深入-commonjs-与-es6-module" aria-hidden="true" class="header-anchor">#</a> 深入 CommonJs 与 ES6 Module</h2> <p>目前主流的模块规范</p> <ul><li>UMD：可以同时运行在node环境与浏览器的代码（amd+commonjs+全局变量）</li> <li>CommonJs  （运行在NODE环境下）</li> <li>AMD - RequireJs（运行在浏览器环境下）</li> <li>CMD - seaJS</li> <li>es6 module</li></ul> <h2 id="模块化的发展"><a href="#模块化的发展" aria-hidden="true" class="header-anchor">#</a> 模块化的发展</h2> <ul><li><p>1.<strong>最开始的时候</strong>，JS自身是没有模块机制的。项目有多个js文件。但是随着项目的增加，代码量的增多，所需要加载的文件就会原来越多，这个时候就要考虑一些，比如：</p> <ul><li>命名问题：命名是否会冲突</li> <li>依赖问题：因为javascript是顺序加载，我们就需要考虑加载的顺序</li> <li>网络问题：如果文件过多，加载时间会很长。</li></ul></li> <li><p>从<code>Commonjs</code>说起，<code>nodejs</code>是<code>commonjs</code>的实现，<code>webpack</code>也也是<code>commonjs</code>的实现，思想就是一个单独的文件就是一个模块</p></li> <li><p><code>AMD</code> 但是由于<code>commonjs</code>只适用于服务端（因为<code>require</code>是一个同步操作，在服务端内，因为所有的模块都存放在硬盘里，可以同步加载，等待时间就是一个读写时间，这样的情况在服务端是很正常的，但是在浏览器端执行这样一个同步任务可能就会把dom阻塞），所以在浏览器端就不能通过同步加载了，只能是异步加载，于是 amd（异步加载定义） 就出现了，他采用了异步加载的方式，模块加载会影响后边语句的执行，所有依赖这个模块的语句都定义到一个回调函数内，等加载完成之后，这个回调才会执行.提前加载，提前执行</p></li> <li><p><code>CMD</code>由于AMD的运行逻辑是依赖前置，所以AMD就做了优化，依赖就近，谁用谁取。</p></li> <li><p><code>UMD</code>因为commonjs与AMD模块化规范不能同时使用，就出现了UMD，他同时支持AMD与Commonjs，还支持老式的全局变量规范。</p></li> <li><p><code>ES6</code> 因为如果用AMD或者CMD的化我们就需要引入一些必要的js，所以就有了es6的模块化的出现，他支持commonjs，每一个模块内声明的变量都是局部变量， 不会污染全局作用域；模块内部的变量或者函数可以通过export导出；；一个模块可以导入别的模块；每一个模块只加载一次， 每一个JS只执行一次， 如果下次再去加载同目录下同文件，直接从内存中读取。 一个模块就是一个单例，或者说就是一个对象；</p></li></ul> <h2 id="commonjs"><a href="#commonjs" aria-hidden="true" class="header-anchor">#</a> CommonJs</h2> <p>Nodejs 环境所使用的模块系统就是基于CommonJs规范实现的，我们现在所说的CommonJs规范也大多是指Node的模块系统。</p> <p>CommonJS规范，主要运行于服务器端，同步加载模块，而加载的文件资源大多数在本地服务器，所以执行速度或时间没问题。Node.js很好的实现了该规范。
该规范指出，一个单独的文件就是一个模块。</p> <p>模块功能主要的几个命令：<code>require</code>和<code>module.exports</code>。<code>require</code>命令用于输入其他模块提供的功能，<code>module.exports</code>命令用于规范模块的对外接口，输出的是一个值的拷贝，输出之后就不能改变了，会缓存起来。</p> <h3 id="模块导出"><a href="#模块导出" aria-hidden="true" class="header-anchor">#</a> 模块导出</h3> <p>关键字：<code>module.exports</code> <code>exports</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// foo.js

//一个一个 导出

module.exports.age = 1
module.exports.foo = function(){}
exports.a = 'hello'

//整体导出
module.exports = { age: 1, a: 'hello', foo:function(){} }

//整体导出不能用`exports` 用exports不能在导入的时候使用

exports = { age: 1, a: 'hello', foo:function(){} }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>这里需要注意 <code>exports</code> 不能被赋值，可以理解为在模块开始前<code>exports = module.exports</code>， 因为赋值之后<code>exports</code>失去了 对<code>module.exports</code>的引用，成为了一个模块内的局部变量</p> <h3 id="模块导入"><a href="#模块导入" aria-hidden="true" class="header-anchor">#</a> 模块导入</h3> <p>关键字：<code>require</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const foo = require('./foo.js')
console.log(foo.age) //1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="模块导入规则："><a href="#模块导入规则：" aria-hidden="true" class="header-anchor">#</a> 模块导入规则：</h4> <p>假设以下目录为 <code>src/app/index.js</code> 的文件 调用 <code>require()</code></p> <h5 id="_1、-modulea相对路径开头"><a href="#_1、-modulea相对路径开头" aria-hidden="true" class="header-anchor">#</a> 1、<code>./moduleA</code>相对路径开头</h5> <p>在没有指定后缀名的情况下</p> <p>先去寻找同级目录同级目录：<code>src/app/</code></p> <ul><li><code>src/app/moduleA</code> 无后缀名文件 按照<code>javascript</code>解析</li> <li><code>src/app/moduleA.js</code> js文件 按照<code>javascrip</code>t解析</li> <li><code>src/app/moduleA.json</code> json文件 按照<code>json</code>解析</li> <li><code>src/app/moduleA.node</code> node文件 按照加载的编译插件模块<code>dlopen</code>
同级目录没有 <code>moduleA</code> 文件会去找同级的 <code>moduleA目录</code>：<code>src/app/moduleA</code></li> <li><code>src/app/moduleA/package.json</code> 判断该目录是否有<code>package.json</code>文件， 如果有 找到<code>main</code>字段定义的文件返回， 如果 <code>main</code> 字段指向文件不存在 或 <code>main</code>字段不存在 或 <code>package.json</code>文件不存在向下执行</li> <li><code>src/app/moduleA/index.js</code></li> <li><code>src/app/moduleA/index.json</code></li> <li><code>src/app/moduleA/index.node</code></li> <li>结束</li></ul> <h5 id="_2、-module-modulea绝对路径开头"><a href="#_2、-module-modulea绝对路径开头" aria-hidden="true" class="header-anchor">#</a> 2、<code>/module/moduleA</code>绝对路径开头</h5> <p>直接在/module/moduleA目录中寻找 <code>规则同上</code></p> <h5 id="_3、react-没有路径开头"><a href="#_3、react-没有路径开头" aria-hidden="true" class="header-anchor">#</a> 3、<code>react</code> 没有路径开头</h5> <p>没有路径开头则视为导入一个包</p> <p>会先判断<code>moduleA</code>是否是一个核心模块 如<code>path</code>，<code>http</code>，优先导入核心模块
不是核心模块 会从当前文件的同级目录的<code>node_modules</code>寻找</p> <ul><li>/src/app/node_modules/ 寻找规则同上 以导入react为例</li></ul> <p>先 node_modules 下 react 文件 -&gt; react.js -&gt; react.json -&gt; react.node -&gt;react目录 -&gt; react package.json main -&gt; index.js -&gt; index.json -&gt; index.node 如果没找到 继续向父目录的node_modules中找</p> <ul><li>/src/node_modules/</li> <li>/node_modules/  (全局)</li></ul> <p>直到最后找不到 结束</p> <h5 id="_4、require-wrapper"><a href="#_4、require-wrapper" aria-hidden="true" class="header-anchor">#</a> 4、require wrapper</h5> <p><code>Node</code>的模块 实际上可以理解为代码被包裹在一个函数包装器内</p> <p>一个简单的require demo：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>function wrapper (script) {
    return '(function (exports, require, module, __filename, __dirname) {' + 
        script +
     '\n})'
}

function require(id) {
 var cachedModule = Module._cache[id];
  if(cachedModule){
    return cachedModule.exports;
  }
  
  const module = { exports: {} }

  // 这里先将引用加入缓存 后面循环引用会说到
  Module._cache[id] = module

  //当然不是eval这么简单
  eval(wrapper('module.exports = &quot;123&quot;'))(module.exports, require, module, 'filename', 'dirname')


  return module.exports
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>也可以查看：<a href="https://github.com/nodejs/node/blob/master/lib/internal/modules/cjs/loader.js" target="_blank" rel="noopener noreferrer">node module 源码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>从以上代码我们可以知道：</p> <ul><li><p>模块只执行一次 之后调用获取的 <code>module.exports</code> 都是缓存哪怕这个 <code>js</code> 还没执行完毕（因为先加入缓存后执行模块）</p></li> <li><p>模块导出就是return这个变量的其实跟a = b赋值一样， 基本类型导出的是值， 引用类型导出的是引用地址
<code>exports</code> 和 <code>module.exports</code> 持有相同引用，因为最后导出的是 <code>module.exports</code>， 所以对<code>exports</code>进行赋值会导致<code>exports</code>操作的不再是<code>module.exports</code>的引用</p></li></ul> <h3 id="循环引用"><a href="#循环引用" aria-hidden="true" class="header-anchor">#</a> 循环引用</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>// a.js
module.exports.a = 1
var b = require('./b')
console.log(b)
module.exports.a = 2

// b.js
module.exports.b = 11
var a = require('./a')
console.log(a)
module.exports.b = 22

//main.js
var a = require('./a')
console.log(a)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>运行此段代码结合上面的require demo，分析每一步过程：</p> <ul><li><p>1、执行 node main.js -&gt; 第一行 require(a.js)，（node 执行也可以理解为调用了require方法，我们省略require(main.js)内容）</p></li> <li><p>2、进入 require(a)方法： 判断缓存（无） -&gt; 初始化一个 module -&gt; 将 module 加入缓存 -&gt; 执行模块 a.js 内容，（需要注意 是<code>先加入缓存， 后执行模块内容</code>）</p></li> <li><p>3、a.js： 第一行导出 a = 1 -&gt; 第二行 require(b.js)（a 只执行了第一行）</p></li> <li><p>4、进入 require(b) 内 同 1 -&gt; 执行模块 b.js 内容</p></li> <li><p>5、b.js： 第一行 b = 11 -&gt; 第二行 require(a.js)</p></li> <li><p>6、require(a) 此时 a.js 是第二次调用 require -&gt; 判断缓存（有）-&gt; cachedModule.exports -&gt; 回到 b.js（因为js对象引用问题 此时的 cachedModule.exports = { a: 1 }）</p></li> <li><p>7、b.js：第三行 输出 { a: 1 } -&gt; 第四行 修改 b = 22 -&gt; 执行完毕回到 a.js</p></li> <li><p>8、a.js：第二行 require 完毕 获取到 b -&gt; 第三行 输出 { b: 22 } -&gt; 第四行 导出 a = 2 -&gt; 执行完毕回到 main.js</p></li> <li><p>9、main.js：获取 a -&gt; 第二行 输出 { a: 2 } -&gt; 执行完毕</p></li></ul> <p>以上就是node的module模块解析和运行的大致规则</p> <h2 id="amd"><a href="#amd" aria-hidden="true" class="header-anchor">#</a> AMD</h2> <p><code>AMD</code>(Asynchronous Module Definition - 异步加载模块定义)规范，制定了定义模块的规则,一个单独的文件就是一个模块，模块和模块的依赖可以被异步加载。主要运行于浏览器端，这和浏览器的异步加载模块的环境刚好适应，它不会影响后面语句的运行。该规范是在<code>RequireJs</code>的推广过程中逐渐完善的。</p> <p>模块功能主要的几个命令：<code>define</code>、<code>require</code>、<code>return</code>和<code>define.amd</code>。<code>define</code>是全局函数，用来定义模块,<code>define(id?, dependencies?, factory)</code>。<code>require</code>命令用于输入其他模块提供的功能，<code>return</code>命令用于规范模块的对外接口，<code>define.amd</code>属性是一个对象，此属性的存在来表明函数遵循<code>AMD</code>规范</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// moduleA.js
define(['jQuery','lodash'], function($, _) {
var name = 'weiqinl',
function foo() {}
return {
name,
foo
}
})

// index.js
require(['moduleA'], function(a) {
a.name === 'weiqinl' // true
a.foo() // 执行A模块中的foo函数
// do sth...
})

// index.html
&lt;script src=&quot;js/require.js&quot; data-main=&quot;js/index&quot;&gt;&lt;/script&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>在这里，我们使用<code>define</code>来定义模块，<code>return</code>来输出接口， <code>require</code>来加载模块，这是<code>AMD</code>官方推荐用法。当然也可以使用其他兼容性的写法，比如对 <code>Simplified CommonJS Wrapper</code>格式的支持，但背后还是原始<code>AMD</code>的运行逻辑。
<code>AMD</code>的运行逻辑是：<strong>提前加载，提前执行</strong>。在<code>Requirejs</code>中，申明依赖模块时，会第一时间加载并执行模块内的代码，使后面的回调函数能在所需的环境中运行。
为了更好地优化请求，同时推出了打包工具<code>r.js</code>，使所需加载的文件数减少。<a href="https://github.com/weiqinl/demo/tree/master/02-require-r-example" target="_blank" rel="noopener noreferrer">require.js模块化开发，并用r.js打包例子<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="cmd"><a href="#cmd" aria-hidden="true" class="header-anchor">#</a> CMD</h2> <p><code>CMD</code>(Common Module Definition - 通用模块定义)规范主要是<code>Sea.js</code>推广中形成的，一个文件就是一个模块，可以像<code>Node.js</code>一般书写模块代码。主要在浏览器中运行，当然也可以在<code>Node.js</code>中运行。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// moduleA.js
// 定义模块
define(function(require, exports, module) {
var func = function() {
var a = require('./a') // 到此才会加载a模块
a.func()
if(false) {
var b = require('./b') // 到此才会加载b模块
b.func()
}
}
// do sth...
exports.func = func;
})

// index.js
// 加载使用模块
seajs.use('moduleA.js', function(ma) {
var ma = math.func()
})

// HTML，需要在页面中引入sea.js文件。
&lt;script src=&quot;./js/sea.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;./js/index.js&quot;&gt;&lt;/script&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>这里<code>define</code>是一个全局函数，用来定义模块，并通过<code>exports</code>向外提供接口。之后，如果要使用某模块，可以通过<code>require</code>来获取该模块提供的接口。最后使用某个组件的时候，通过<code>seajs.use()</code>来调用。</p> <ul><li>通过exports暴露接口。这意味着不需要命名空间了，更不需要全局变量。</li> <li>通过require引入依赖。这可以让依赖内置，我们只需要关心当前模块的依赖。关注度分离</li></ul> <p>CMD推崇<strong>依赖就近，延迟执行</strong>。在上面例子中，通过require引入的模块，只有当程序运行到此处的时候，模块才会自动加载执行。</p> <h2 id="umd-模块（通用模块）"><a href="#umd-模块（通用模块）" aria-hidden="true" class="header-anchor">#</a> umd 模块（通用模块）</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 使用Node, AMD 或 browser globals 模式创建模块
(function (root, factory) {
    if (typeof define === 'function' &amp;&amp; define.amd) {
        // AMD模式. 注册为一个匿名函数
        define(['b'], factory);
    } else if (typeof module === 'object' &amp;&amp; module.exports)   {
          // Node等类CommonJS的环境
          module.exports = factory(require('b'));
      } else {
          // 浏览器全局变量 (root is window)
          root.returnExports = factory(root.b);
      }
}(typeof self !== 'undefined' ? self : this, function (b) {
    // 以某种方式使用 b

    //返回一个值来定义模块导出。(即可以返回对象，也可以返回函数)
    return {};
}));
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>如果你在js文件头部看到这样的代码，那么这个文件使用的就是 UMD 规范
实际上就是 <code>amd</code> + <code>commonjs</code> + <code>全局变量</code> 这三种风格的结合
这段代码就是对当前运行环境的判断，如果是 <code>Node</code> 环境 就是使用 <code>CommonJs</code> 规范， 如果<strong>不是</strong>就判断是否为 <code>AMD</code> 环境， 最后导出全局变量</p> <ul><li>判断define为函数，并且是否存在define.amd，来判断是否为AMD规范,</li> <li>判断module是否为一个对象，并且是否存在module.exports来判断是否为CommonJS规范</li> <li>如果以上两种都没有，设定为原始的代码规范。</li> <li>这种模式，通常会在webpack打包的时候用到。output.libraryTarget将模块以哪种规范的文件输出。</li></ul> <p>有了 UMD 后我们的代码就可以同时运行在 Node 和 浏览器上</p> <p>所以现在前端大多数的库最后打包都使用的是 UMD 规范</p> <h2 id="es6-module"><a href="#es6-module" aria-hidden="true" class="header-anchor">#</a> es6 module</h2> <p><code>ES6</code> 之前 <code>javascript</code> 一直没有属于自己的模块规范，所以社区制定了 <code>CommonJs规范</code>， <code>Node</code> 从 <code>Commonjs</code> 规范中借鉴了思想于是有了 <code>Node</code> 的 <code>module</code>，而 <code>AMD</code> 异步模块 也同样脱胎于 <code>Commonjs</code> 规范，之后有了运行在浏览器上的 <code>require.js</code></p> <h3 id="es6-module-基本语法："><a href="#es6-module-基本语法：" aria-hidden="true" class="header-anchor">#</a> es6 module 基本语法：</h3> <blockquote><p>export</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>export * from 'module'; //重定向导出 不包括 module内的default

export { name1, name2, ..., nameN } from 'module'; // 重定向命名导出

export { import1 as name1, import2 as name2, ..., nameN } from 'module'; // 重定向重命名导出

export { name1, name2, …, nameN }; // 与之前声明的变量名绑定 命名导出

export { variable1 as name1, variable2 as name2, …, nameN }; // 重命名导出

export let name1 = 'name1'; // 声明命名导出 或者 var, const，function， function*, class

export default expression; // 默认导出

export default function () { ... } // 或者 function*, class

export default function name1() { ... } // 或者 function*, class

export { name1 as default, ... }; // 重命名为默认导出
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><blockquote><p>export 规则</p></blockquote> <ul><li><p>export * from '' 或者 export {} from ''，重定向导出，重定向的命名并不能在本模块使用，只是搭建一个桥梁，例如：这个a并不能在本模块内使用</p></li> <li><p>export {}， 与变量名绑定，命名导出</p></li> <li><p>export Declaration，声明的同时，命名导出， Declaration就是： var, let, const, function, function*, class 这一类的声明语句</p></li> <li><p>export default AssignmentExpression，默认导出， AssignmentExpression的 范围很广，可以大致理解 为除了声明Declaration（其实两者是有交叉的），<code>a=2</code>,<code>i++,``i/4</code>,<code>a===b,``obj[name]</code>,<code>name in obj</code>,<code>func()</code>,<code>new P()</code>,<code>[1,2,3]</code>,<code>function(){}</code>等等很多</p></li></ul> <blockquote><p>import</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 命名导出 module.js
let a = 1,b = 2
export { a, b }
export let c = 3

// 命名导入 main.js
import { a, b, c } from 'module'; // a: 1  b: 2  c: 3
import { a as newA, b, c as newC } from 'module'; // newA: 1  b: 2  newC: 3


// 默认导出 module.js
export default 1

// 默认导入 main.js
import defaultExport from 'module'; // defaultExport: 1


// 混合导出 module.js
let a = 1
export { a }
const b = 2
export { b }
export let c = 3
export default [1, 2, 3]

// 混合导入 main.js
import defaultExport, { a, b, c as newC} from 'module'; //defaultExport: [1, 2, 3]  a: 1  b: 2  newC: 3
import defaultExport, * as name from 'module'; //defaultExport: [1, 2, 3]  name: { a: 1, b: 2, c: 3 }
import * as name from 'module'; // name: { a: 1, b: 2, c: 3, default: [1, 2, 3] }


// module.js
Array.prototype.remove = function(){}

//副作用 只运行一个模块
import 'module'; // 执行module 不导出值  多次调用module.js只运行一次

//动态导入(异步导入)
var promise = import('module');
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><blockquote><p>import 规则</p></blockquote> <ul><li>import { } from 'module'， 导入module.js的命名导出</li> <li>import defaultExport from 'module'， 导入module.js的默认导出</li> <li>import * as name from 'module'， 将module.js的的所有导出合并为name的对象，key为导出的命名，默认导出的key为default</li> <li>import 'module'，副作用，只是运行module，不为了导出内容例如 polyfill，多次调用次语句只能执行一次</li> <li>import('module')，动态导入返回一个 Promise，TC39的stage-3阶段被提出 tc39 import</li></ul> <blockquote><p>ES6 module 特点</p></blockquote> <p>ES6 module的语法是静态的</p> <p><strong>import 会自动提升到代码的顶层</strong></p> <p>export 和 import 只能出现在代码的顶层，下面这段语法是错误的</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> //if for while 等都无法使用
{
  export let a = 1

  import defaultExport from 'module'
}

true || export let a = 1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>import 的导入名不能为字符串或在判断语句，下面代码是错误的</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import 'defaultExport' from 'module'

let name = 'Export'
import 'default' + name from 'module'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>静态的语法意味着可以在编译时确定导入和导出，更加快速的查找依赖，可以使用lint工具对模块依赖进行检查，可以对导入导出加上类型信息进行静态的类型检查</strong></p> <blockquote><p>ES6 module的导出是绑定的</p></blockquote> <ul><li><p>使用 import 被导入的模块运行在严格模式下</p></li> <li><p>使用 import 被导入的变量是只读的，可以理解默认为 const 装饰，无法被赋值</p></li> <li><p>使用 import 被导入的变量是与原变量绑定/引用的，可以理解为 import 导入的变量无论是否为基本类型都是引用传递</p></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>// js中 基础类型是值传递
let a = 1
let b = a
b = 2
console.log(a,b) //1 2

// js中 引用类型是引用传递
let obj = {name:'obj'}
let obj2 = obj
obj2.name = 'obj2'
console.log(obj.name, obj2.name) // obj2  obj2


// es6 module 中基本类型也按引用传递
// foo.js
export let a = 1
export function count(){
  a++
}

// main.js
import { a, count } from './foo'
console.log(a) //1
count()
console.log(a) //2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>上面这段代码就是 CommonJs 导出变量 和 ES6 导出变量的区别</p> <blockquote><p>es module 循环引用</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>// bar.js
import { foo } from './foo'
console.log(foo);
export let bar = 'bar'

// foo.js
import { bar } from './bar'
console.log(bar);
export let foo = 'foo'

// main.js
import { bar } from './bar'
console.log(bar)  //
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>1、执行 main.js -&gt; 导入 bar.js</p> <p>2、bar.js -&gt; 导入 foo.js</p> <p>3、foo.js -&gt; 导入 bar.js -&gt; bar.js 已经执行过直接返回 -&gt; 输出 bar -&gt; <code>bar is not defined</code>， bar 未定义报错</p> <p>我们可以使用function的方式解决：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// bar.js
import { foo } from './foo'
console.log(foo());
export function bar(){
  return 'bar'
}

// foo.js
import { bar } from './bar'
console.log(bar());
export function foo(){
  return 'foo'
}

// main.js
import { bar } from './bar'
console.log(bar)

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>因为函数声明会提示到文件顶部，所以就可以直接在 foo.js 调用还没执行完毕的bar.js的 bar 方法</p> <h2 id="commonjs-和-es6-module-的区别"><a href="#commonjs-和-es6-module-的区别" aria-hidden="true" class="header-anchor">#</a> CommonJs 和 ES6 Module 的区别</h2> <p>其实上面我们已经说到了一些区别</p> <ul><li>CommonJs导出的是变量的一份拷贝，ES6 Module导出的是变量的绑定（引用）</li> <li>CommonJs是单个值导出，ES6 Module可以导出多个</li> <li>CommonJs是动态语法可以写在判断里，ES6 Module静态语法只能写在顶层</li> <li>CommonJs的 this 是当前模块，ES6 Module的 this 是 undefined
易混淆点</li></ul> <h3 id="模块语法与解构"><a href="#模块语法与解构" aria-hidden="true" class="header-anchor">#</a> 模块语法与解构</h3> <p>module语法与解构语法很容易混淆，例如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import { a } from 'module'

const { a } = require('module')
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>尽管看上去很像，但是不是同一个东西，这是两种完全不一样的语法与作用，ps:两个人撞衫了，穿一样的衣服你不能说这俩人就是同一个人</p> <p>module 的语法： 上面有写 <code>import/export { a } / { a, b } / { a as c} FromClause</code>
解构 的语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>let { a } = { a: 1 }
let { a = 2 } = { }
let { a: b } = { a: 1 }
let { a: b = 2, ...res } = { name:'a' }
let { a: b, obj: { name } } = { a: 1, obj: { name: '1' } }

function foo({a: []}) {}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>他们是差别非常大的两个东西，一个是<code>模块导入导出</code>，一个是<code>获取对象的语法糖</code></p> <blockquote><p>导出语法与对象属性简写</p></blockquote> <p>同样下面这段代码也容易混淆</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>let a = 1

export { a } // 导出语法
export default { a } // 属性简写 导出 { a: 1 } 对象

module.exports = { a } // 属性简写 导出 { a: 1 } 对象
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>export default</code> 和 <code>module.exports</code> 是相似的</p> <h3 id="es6-module-支持-commonjs-情况"><a href="#es6-module-支持-commonjs-情况" aria-hidden="true" class="header-anchor">#</a> ES6 module 支持 CommonJs 情况</h3> <p>先简单说一下各个环境的 ES6 module 支持 CommonJs 情况，后面单独说如何在不同环境中使用</p> <p>因为 module.exports 很像 export default 所以 ES6模块 可以很方便兼容 CommonJs
在<code>ES6 module</code>中使用<code>CommonJs</code>规范，根据各个环境，打包工具不同也是不一样的</p> <p>我们现在大多使用的是 <code>webpack</code> 进行项目构建打包，因为现在前端开发环境都是在 <code>Node</code> 环境原因，而 <code>npm</code> 的包都是 <code>CommonJs</code> 规范的，所以 <code>webpack</code> 对ES6模块进行扩展 支持 <code>CommonJs</code>，并支持node的导入npm包的规范</p> <p>如果你使用 <code>rollup</code> ，想在<code>ES Module</code>中支持<code>Commonjs</code>规范就需要<strong>下载</strong><code>rollup-plugin-commonjs</code>插件，想要导入<code>node_modules</code>下的包也需要<code>rollup-plugin-node-resolve</code>插件</p> <p>如果你使用 <code>node</code>，可以在 .mjs 文件使用 ES6，也支持 <code>CommonJs</code> 查看 nodejs es-modules.md</p> <p><strong>在浏览器环境 不支持CommonJs</strong></p> <blockquote><p>node 与 打包工具webpack，rollup的导入 CommonJs 差异</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>// module.js
module.export.a = 1

// index.js webpack rollup
import * as a from './module'
console.log(a) // { a: 1, default: { a:1 } }

// index.mjs node
import * as a from './module'
console.log(a) // { default: { a:1 } }
node 只是把 module.exports 整体当做 export default
打包工具除了把 module.export 整体当做 export default，还把 module.export 的每一项 又当做 export 输出，这样做是为了更加简洁 
import defaultExport from './foo'， defaultExport.foo()
import { foo } from './foo'， foo()
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>使用 ES6 Module</p></blockquote> <p>可以在 <a href="https://github.com/Li13/module" target="_blank" rel="noopener noreferrer">es6module example <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>仓库中获取代码在本地进行测试验证</p> <p><strong>浏览器中使用</strong></p> <p>你需要起一个Web服务器来访问，双击本地运行 index.html 并不会执行</p> <p><code>type=module 标签 我们可以对 script 标签的 type 属性加上 module</code></p> <p>先定义两个模块</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// index.js
import module from './module.js'
console.log(module) // 123

// module.js
export default 123
在html中内联调用

&amp;lt;!-- index.html --&amp;gt; &amp;lt;script type=&quot;module&quot;&amp;gt; import module from './module.js' console.log(module) // 123 &amp;lt;/script&amp;gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在html中内联调用</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&amp;lt;!-- index.html --&amp;gt; &amp;lt;script type=&quot;module&quot; src=&quot;index.js&quot;&amp;gt;&amp;lt;/script&amp;gt; // 控制台 123
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>浏览器导入路径规则</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>https://example.com/apples.mjs
http://example.com/apples.js
//example.com/bananas
./strawberries.mjs.cgi
../lychees
/limes.jsx
data:text/javascript,export default 'grapes';
blob:https://whatwg.org/d0360e2f-caee-469f-9a2f-87d5b0456f6f

补充:

不加 后缀名 找不到具体的文件
后端可以修改接口/getjs?name=module这一类的，不过后端要返回 Content-Type: application/javascript 确保返回的是js,因为浏览器是根据 MIME type 识别的
因为 ES6 Module 在浏览器中兼容并不是很好，这里就不介绍浏览器支持情况了，我们一般不会直接在浏览器中使用

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="nodejs中使用"><a href="#nodejs中使用" aria-hidden="true" class="header-anchor">#</a> Nodejs中使用</h3> <p><em><a href="https://github.com/nodejs/node-eps/blob/master/002-es-modules.md" target="_blank" rel="noopener noreferrer">nodejs es-modules.md<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></em></p> <p>在 Node v8.5.0 以上支持 ES Module，需要 .mjs扩展名</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>NOTE: DRAFT status does not mean ESM will be implemented in Node core. Instead that this is the standard, should Node core decide to implement ESM. At which time this draft would be moved to ACCEPTED.
（上面链接可以知道 ES Module的状态是 DRAFT， 属于起草阶段）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>// module.mjs
export default 123

// index.mjs
import module from './module.mjs'
console.log(module) // 123
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>我们需要执行 <code>node --experimental-modules index.mjs</code> 来启动
会提示一个 ExperimentalWarning: The ESM module loader is experimental.该功能是实验性的（此提示不影响执行）
ES Module 中导入 CommonJs</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// module.js
module.exports.a = 123 // module.exports 就相当于 export default

// index.mjs
import module from './module.js'
console.log(module) // { a: 123 }

import * as module from './module.js'
console.log(module) // { get default: { a: 123 } }

import { default as module } from './module.js';
console.log(module) // { a: 123 }

import module from 'module'; // 导入npm包 导入规则与 require 差不多
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>导入路径规则与require差不多</strong></p> <p>这里要注意 <code>module</code> 扩展名为 <code>.js</code>，<code>.mjs</code>专属于 <code>es module</code>，<code>import form</code>导入的文件后缀名只能是<code>.mjs</code>，在 <code>.mjs</code>中 <code>module</code>未定义， 所以调用 <code>module.exports，exports</code> 会报错</p> <p><code>node</code>中 <code>CommonJs</code> 导入 <code>es module</code> 只能使用 <code>import()</code>动态导入/异步导入</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// es.mjs
let foo = {name: 'foo'};
export default foo;

export let a = 1

// cjs
import('./es').then((res)=&amp;gt;{
  console.log(res) // { get default: {name: 'foo'}, a: 1 }
});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="webpack中使用"><a href="#webpack中使用" aria-hidden="true" class="header-anchor">#</a> webpack中使用</h3> <p>从 webpack2 就默认支持 es module 了，并默认支持 CommonJs，支持导入 npm包， 这里 import 语法上面写太多 就不再写了</p> <h2 id="rollup中使用"><a href="#rollup中使用" aria-hidden="true" class="header-anchor">#</a> rollup中使用</h2> <p><code>rollup</code> 专注于 <code>es module</code>，可以将 <code>es module</code> 打包为主流的模块规范，注意这里与 <code>webpack</code> 的区别，我们可以在 <code>webpack</code> 的 <code>js</code> 中使用 <code>Commonjs</code> 语法， 但是 <code>rollup</code> 不支持，<code>rollup</code>需要 <code>plugin</code> 支持，包括加载 <code>node_modules</code> 下的包 <code>form</code> <code>'react'</code>也需要 <code>plugin</code> 支持</p> <p>可以看到 es module 在浏览器与node中兼容性差与实验功能的</p> <p>我们大多时候在 打包工具 中使用</p> <h2 id="tree-shaking"><a href="#tree-shaking" aria-hidden="true" class="header-anchor">#</a> Tree-shaking</h2> <p>在最后我们说一下经常跟 es module 一起出现的一个名词 <code>Tree-shaking</code></p> <p><code>Tree-shaking</code>我们先直译一下 树木摇晃 就是 摇晃树木把上面枯死的树叶晃下来，在代码中就是把<strong>没有用到的代码删除</strong></p> <p><code>Tree-shaking</code> 最早由 <code>rollup</code> 提出，之后 <code>webpack 2</code> 也开始支持</p> <p>这都是基于 <code>es module</code> 模块特性的静态分析</p> <blockquote><p>rollup</p></blockquote> <p>下面代码使用 <code>rollup</code> 进行打包：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// module.js
export let foo = 'foo'
export let bar = 'bar'

// index.js
import { foo } from './module'
console.log(foo) // foo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在线运行 我们可以修改例子与导出多种规范</p> <p>打包结果：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>let foo = 'foo';

console.log(foo); // foo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>可以看到 rollup 打包结果非常的简洁，并去掉了没有用到的 bar
是否支持对导入 <code>CommonJs</code> 的规范进行 <code>Tree-shaking：</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// index.js
import { a } from './module'
console.log(a) // 1

// module.js
module.exports.a = 1
module.exports.b = 2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>打包为 <strong><code>es module</code></strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>var a_1 = 2;

console.log(a_1);
可以看到去掉了未使用的 b

webpack

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>webpack
我们下面看看 <code>webpack</code> 的支持情况</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>// src/module.js
export function foo(){ return 'foo' }
export function bar(){ return 'bar' }

// src/index.js
import { foo } from './module'
console.log(foo())
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>执行 <code>npx webpack -p</code>（我们使用<code>webpack 4，0</code>配置，-p开启生成模式 自动压缩）</p> <p>打包后我们在打包文件搜索 bar 没有搜到，bar被删除</p> <p>我们将上面例子修改一下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// src/module.js
module.exports.foo = function (){ return 'foo' }
module.exports.bar = function (){ return 'bar' }

// src/index.js
import { foo } from './module'
console.log(foo())
打包后搜索 bar 发现bar存在，webpack 并不支持对CommonJs 进行 Tree-shaking
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="pkg-module"><a href="#pkg-module" aria-hidden="true" class="header-anchor">#</a> pkg.module</h2> <p>webpack 不支持 Commonjs Tree-shaking，但现在npm的包都是CommonJs规范的，这该怎么办呢 ？如果我发了一个新包是 es module 规范， 但是如果代码运行在 node 环境，没有经过打包 就会报错</p> <p>有一种按需加载的方案</p> <p>全路径导入，导入具体的文件：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// src/index.js
import remove from 'lodash/remove'
import add from 'lodash/add'

console.log(remove(), add())
使用一个还好，如果用多个的话会有很多 import 语句
还可以使用插件如 babel-plugin-lodash, &amp; lodash-webpack-plugin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>但我们不能发一个库就自己写插件</p> <p><strong>这时就提出了在 package.json 加一个 module 的字段来指向 es module规范的文件，main -&gt; CommonJs，那么module - es module pkg.module</strong></p> <p><code>webpack</code> 与 <code>rollup</code> 都支持 <code>pkg.module</code></p> <p>加了 module 字段 webpack 就可以识别我们的 es module，但是还有一个问题就是 babel</p> <p>我们一般使用 babel 都会排除 node_modules，所以我们这个 pkg.module 只是的 es6 module必须是编译之后的 es5 代码，因为 babel 不会帮我们编译，我们的包就必须是 拥有 es6 module 规范的 es5 代码</p> <p>如果你使用了 presets-env 因为会把我们的代码转为 CommonJs 所以就要设置 &quot;presets&quot;: [[&quot;env&quot;, {&quot;modules&quot;:false}] 不将es module 转为 CommonJs</p> <blockquote><p>webpack 与 rollup 的区别</p></blockquote> <ul><li>1.webpack 不支持导出 es6 module 规范，rollup 支持导出 es6 module</li> <li>2.webpack 打包后代码很多冗余无法直接看，rollup 打包后的代码简洁，可读，像源码</li> <li>3.webpack 可以进行代码分割，静态资源处理，HRM，rollup 专注于 es module，tree-shaking更加强大的，精简</li></ul> <p>如果是开发应用可以使用 webpack，因为可以进行代码分割，静态资源，HRM，插件</p> <p>如果是开发类似 vue，react 等类库，rollup 更好一些，因为可以使你的代码精简，无冗余代码，执行更快,导出多种模块语法</p> <h2 id="参考链接"><a href="#参考链接" aria-hidden="true" class="header-anchor">#</a> 参考链接</h2> <p><a href="http://www.ecma-international.org/ecma-262/6.0/" target="_blank" rel="noopener noreferrer">ECMAScript® 2015 Language Specification sec-imports/
sec-exports<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/import" target="_blank" rel="noopener noreferrer">MDN import<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/nodejs/node/blob/master/lib/internal/modules/cjs/loader.js" target="_blank" rel="noopener noreferrer">github nodejs lib/module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/nodejs/node-eps/blob/master/002-es-modules.md" target="_blank" rel="noopener noreferrer">github nodejs node-eps/002-es-modules<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://nodejs.org/dist/latest-v10.x/docs/api/modules.html" target="_blank" rel="noopener noreferrer">nodejs docs modules<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://leanpub.com/understandinges6/read" target="_blank" rel="noopener noreferrer">Understanding ECMAScript 6<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.jqhtml.com/7065.html" target="_blank" rel="noopener noreferrer">ECMAScript 6 入门<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="http://2ality.com/2014/09/es6-modules-final.html" target="_blank" rel="noopener noreferrer">es6-modules-final<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/1/2020, 9:00:40 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blogs/views/no.3/browserify.html" class="prev">
          Browserify
        </a></span> <span class="next"><a href="/blogs/views/no.3/grunt.html">
          grunt
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blogs/views/assets/js/app.8e869d74.js" defer></script><script src="/blogs/views/assets/js/2.d340cefd.js" defer></script><script src="/blogs/views/assets/js/56.e471bc3a.js" defer></script>
  </body>
</html>
