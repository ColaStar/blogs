<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CSS魔术师Houdini | 个人博客</title>
    <meta name="description" content="可怜楼上月徘徊，应照离人妆镜台。">
    <link rel="icon" href="https://colastar.github.io/blogs/views/images/favicon.ico">
  <link rel="manifest" href="https://colastar.github.io/blogs/views/js/manifest.json">
  <link rel="apple-touch-icon" href="https://colastar.github.io/blogs/views/images/logo.png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://colastar.github.io/blogs/views/js/tj.js"></script>
  <script src="https://colastar.github.io/blogs/views/js/code.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    
    <link rel="preload" href="/blogs/views/assets/css/0.styles.16aae78f.css" as="style"><link rel="preload" href="/blogs/views/assets/js/app.124666f5.js" as="script"><link rel="preload" href="/blogs/views/assets/js/2.d340cefd.js" as="script"><link rel="preload" href="/blogs/views/assets/js/86.aa8119ea.js" as="script"><link rel="prefetch" href="/blogs/views/assets/js/10.de1d1b31.js"><link rel="prefetch" href="/blogs/views/assets/js/100.7dd0f6ca.js"><link rel="prefetch" href="/blogs/views/assets/js/101.8cc653dc.js"><link rel="prefetch" href="/blogs/views/assets/js/102.95f46c5f.js"><link rel="prefetch" href="/blogs/views/assets/js/103.bf5c7795.js"><link rel="prefetch" href="/blogs/views/assets/js/104.6e54e3d0.js"><link rel="prefetch" href="/blogs/views/assets/js/105.b2f53535.js"><link rel="prefetch" href="/blogs/views/assets/js/106.1728ef60.js"><link rel="prefetch" href="/blogs/views/assets/js/107.874eba85.js"><link rel="prefetch" href="/blogs/views/assets/js/108.c2614d02.js"><link rel="prefetch" href="/blogs/views/assets/js/109.82fcb80b.js"><link rel="prefetch" href="/blogs/views/assets/js/11.1b8006ad.js"><link rel="prefetch" href="/blogs/views/assets/js/110.f68276ee.js"><link rel="prefetch" href="/blogs/views/assets/js/111.a9f3112c.js"><link rel="prefetch" href="/blogs/views/assets/js/112.b69f3a64.js"><link rel="prefetch" href="/blogs/views/assets/js/113.cf77d521.js"><link rel="prefetch" href="/blogs/views/assets/js/114.9ae82395.js"><link rel="prefetch" href="/blogs/views/assets/js/115.577374e7.js"><link rel="prefetch" href="/blogs/views/assets/js/116.2a36ef4f.js"><link rel="prefetch" href="/blogs/views/assets/js/117.01c1ab5b.js"><link rel="prefetch" href="/blogs/views/assets/js/118.32428e42.js"><link rel="prefetch" href="/blogs/views/assets/js/119.f61096c6.js"><link rel="prefetch" href="/blogs/views/assets/js/12.68afe302.js"><link rel="prefetch" href="/blogs/views/assets/js/120.60dba0d2.js"><link rel="prefetch" href="/blogs/views/assets/js/121.60317bf1.js"><link rel="prefetch" href="/blogs/views/assets/js/122.c4a12b85.js"><link rel="prefetch" href="/blogs/views/assets/js/123.54a6477e.js"><link rel="prefetch" href="/blogs/views/assets/js/124.eee0cb78.js"><link rel="prefetch" href="/blogs/views/assets/js/125.2667c23e.js"><link rel="prefetch" href="/blogs/views/assets/js/126.50f00f88.js"><link rel="prefetch" href="/blogs/views/assets/js/127.9c744cd3.js"><link rel="prefetch" href="/blogs/views/assets/js/128.e884999f.js"><link rel="prefetch" href="/blogs/views/assets/js/129.a3c6b20f.js"><link rel="prefetch" href="/blogs/views/assets/js/13.ae95d6bd.js"><link rel="prefetch" href="/blogs/views/assets/js/130.d6342e66.js"><link rel="prefetch" href="/blogs/views/assets/js/131.193c2fa3.js"><link rel="prefetch" href="/blogs/views/assets/js/132.930eff3f.js"><link rel="prefetch" href="/blogs/views/assets/js/133.3f00ce4e.js"><link rel="prefetch" href="/blogs/views/assets/js/134.df1ff1ee.js"><link rel="prefetch" href="/blogs/views/assets/js/135.1296360f.js"><link rel="prefetch" href="/blogs/views/assets/js/136.6fbd3fff.js"><link rel="prefetch" href="/blogs/views/assets/js/137.799a876e.js"><link rel="prefetch" href="/blogs/views/assets/js/138.b9c69e1b.js"><link rel="prefetch" href="/blogs/views/assets/js/139.abf88ec2.js"><link rel="prefetch" href="/blogs/views/assets/js/14.0fdc2bec.js"><link rel="prefetch" href="/blogs/views/assets/js/140.1b0c5edb.js"><link rel="prefetch" href="/blogs/views/assets/js/141.51149e45.js"><link rel="prefetch" href="/blogs/views/assets/js/142.cebde8e8.js"><link rel="prefetch" href="/blogs/views/assets/js/143.7d018666.js"><link rel="prefetch" href="/blogs/views/assets/js/15.a21c9fa9.js"><link rel="prefetch" href="/blogs/views/assets/js/16.755c8a00.js"><link rel="prefetch" href="/blogs/views/assets/js/17.8ad5735b.js"><link rel="prefetch" href="/blogs/views/assets/js/18.f96b8b02.js"><link rel="prefetch" href="/blogs/views/assets/js/19.cb90520d.js"><link rel="prefetch" href="/blogs/views/assets/js/20.ec4b0a60.js"><link rel="prefetch" href="/blogs/views/assets/js/21.7a49f61e.js"><link rel="prefetch" href="/blogs/views/assets/js/22.1ceea7e3.js"><link rel="prefetch" href="/blogs/views/assets/js/23.5f29e810.js"><link rel="prefetch" href="/blogs/views/assets/js/24.bc7f4ca7.js"><link rel="prefetch" href="/blogs/views/assets/js/25.5d00e11e.js"><link rel="prefetch" href="/blogs/views/assets/js/26.b039dc72.js"><link rel="prefetch" href="/blogs/views/assets/js/27.bf672bb7.js"><link rel="prefetch" href="/blogs/views/assets/js/28.d53e649a.js"><link rel="prefetch" href="/blogs/views/assets/js/29.ee363daf.js"><link rel="prefetch" href="/blogs/views/assets/js/3.d1743aad.js"><link rel="prefetch" href="/blogs/views/assets/js/30.c06a5b7a.js"><link rel="prefetch" href="/blogs/views/assets/js/31.0699d199.js"><link rel="prefetch" href="/blogs/views/assets/js/32.6ffac1aa.js"><link rel="prefetch" href="/blogs/views/assets/js/33.1695ddf9.js"><link rel="prefetch" href="/blogs/views/assets/js/34.a3a9f189.js"><link rel="prefetch" href="/blogs/views/assets/js/35.fdf85b51.js"><link rel="prefetch" href="/blogs/views/assets/js/36.ade93422.js"><link rel="prefetch" href="/blogs/views/assets/js/37.b4ede68b.js"><link rel="prefetch" href="/blogs/views/assets/js/38.2bdd656f.js"><link rel="prefetch" href="/blogs/views/assets/js/39.f1a9a8e9.js"><link rel="prefetch" href="/blogs/views/assets/js/4.4e0deb20.js"><link rel="prefetch" href="/blogs/views/assets/js/40.4668d736.js"><link rel="prefetch" href="/blogs/views/assets/js/41.405fb6b6.js"><link rel="prefetch" href="/blogs/views/assets/js/42.1bda99d9.js"><link rel="prefetch" href="/blogs/views/assets/js/43.c68d17a4.js"><link rel="prefetch" href="/blogs/views/assets/js/44.d462bad3.js"><link rel="prefetch" href="/blogs/views/assets/js/45.59254ac0.js"><link rel="prefetch" href="/blogs/views/assets/js/46.4f08518f.js"><link rel="prefetch" href="/blogs/views/assets/js/47.3fd7d93b.js"><link rel="prefetch" href="/blogs/views/assets/js/48.9b701ac9.js"><link rel="prefetch" href="/blogs/views/assets/js/49.96cf687d.js"><link rel="prefetch" href="/blogs/views/assets/js/5.829db2fd.js"><link rel="prefetch" href="/blogs/views/assets/js/50.16133866.js"><link rel="prefetch" href="/blogs/views/assets/js/51.3980d2db.js"><link rel="prefetch" href="/blogs/views/assets/js/52.44143685.js"><link rel="prefetch" href="/blogs/views/assets/js/53.9305f94d.js"><link rel="prefetch" href="/blogs/views/assets/js/54.21f4fcc9.js"><link rel="prefetch" href="/blogs/views/assets/js/55.533bf07c.js"><link rel="prefetch" href="/blogs/views/assets/js/56.e471bc3a.js"><link rel="prefetch" href="/blogs/views/assets/js/57.06090e06.js"><link rel="prefetch" href="/blogs/views/assets/js/58.613a8f0f.js"><link rel="prefetch" href="/blogs/views/assets/js/59.455b80b9.js"><link rel="prefetch" href="/blogs/views/assets/js/6.9b4144c4.js"><link rel="prefetch" href="/blogs/views/assets/js/60.395193e0.js"><link rel="prefetch" href="/blogs/views/assets/js/61.1b7d7ba1.js"><link rel="prefetch" href="/blogs/views/assets/js/62.99f52cbf.js"><link rel="prefetch" href="/blogs/views/assets/js/63.4ebd23d6.js"><link rel="prefetch" href="/blogs/views/assets/js/64.5a64911a.js"><link rel="prefetch" href="/blogs/views/assets/js/65.a77ff8df.js"><link rel="prefetch" href="/blogs/views/assets/js/66.c47af622.js"><link rel="prefetch" href="/blogs/views/assets/js/67.2c379945.js"><link rel="prefetch" href="/blogs/views/assets/js/68.92a830cd.js"><link rel="prefetch" href="/blogs/views/assets/js/69.45e059df.js"><link rel="prefetch" href="/blogs/views/assets/js/7.5dd94ae7.js"><link rel="prefetch" href="/blogs/views/assets/js/70.81c48453.js"><link rel="prefetch" href="/blogs/views/assets/js/71.72192f41.js"><link rel="prefetch" href="/blogs/views/assets/js/72.21d87c42.js"><link rel="prefetch" href="/blogs/views/assets/js/73.0f6b1978.js"><link rel="prefetch" href="/blogs/views/assets/js/74.515cab07.js"><link rel="prefetch" href="/blogs/views/assets/js/75.ae0f2492.js"><link rel="prefetch" href="/blogs/views/assets/js/76.95dcbb33.js"><link rel="prefetch" href="/blogs/views/assets/js/77.96c8d93d.js"><link rel="prefetch" href="/blogs/views/assets/js/78.9bbc784b.js"><link rel="prefetch" href="/blogs/views/assets/js/79.717c6deb.js"><link rel="prefetch" href="/blogs/views/assets/js/8.21e12c98.js"><link rel="prefetch" href="/blogs/views/assets/js/80.06622779.js"><link rel="prefetch" href="/blogs/views/assets/js/81.0e42caac.js"><link rel="prefetch" href="/blogs/views/assets/js/82.5a5723e9.js"><link rel="prefetch" href="/blogs/views/assets/js/83.8e08980b.js"><link rel="prefetch" href="/blogs/views/assets/js/84.969b4f61.js"><link rel="prefetch" href="/blogs/views/assets/js/85.0d6fdaf3.js"><link rel="prefetch" href="/blogs/views/assets/js/87.dc3071a8.js"><link rel="prefetch" href="/blogs/views/assets/js/88.f6e600df.js"><link rel="prefetch" href="/blogs/views/assets/js/89.6a596777.js"><link rel="prefetch" href="/blogs/views/assets/js/9.a65832bd.js"><link rel="prefetch" href="/blogs/views/assets/js/90.346c1af5.js"><link rel="prefetch" href="/blogs/views/assets/js/91.7ec1aaac.js"><link rel="prefetch" href="/blogs/views/assets/js/92.e4c218c8.js"><link rel="prefetch" href="/blogs/views/assets/js/93.45ebe21c.js"><link rel="prefetch" href="/blogs/views/assets/js/94.5c8a85e3.js"><link rel="prefetch" href="/blogs/views/assets/js/95.d8e49d1a.js"><link rel="prefetch" href="/blogs/views/assets/js/96.d2f599f4.js"><link rel="prefetch" href="/blogs/views/assets/js/97.b7213047.js"><link rel="prefetch" href="/blogs/views/assets/js/98.bb7dc460.js"><link rel="prefetch" href="/blogs/views/assets/js/99.bfe690dc.js">
    <link rel="stylesheet" href="/blogs/views/assets/css/0.styles.16aae78f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blogs/views/" class="home-link router-link-active"><!----> <span class="site-name">个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blogs/views/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/views/no.0/js/es6.html" class="nav-link">前端基础</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/javascript-QA/javascriptqa.html" class="nav-link">javaScript与测试工程师</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.1/函数式编程/函数式编程.html" class="nav-link">编程相关</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.2/http.html" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.3/webpack.html" class="nav-link">前端自动化</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.4/前端性能优化.html" class="nav-link">前端优化</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.5/css工作流.html" class="nav-link">css相关</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.6/react/react.html" class="nav-link">框架相关</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.7/计算机组成原理.html" class="nav-link">计算机组成原理</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.8/数据结构与算法.html" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/node/node/node.html" class="nav-link">node相关</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.10/网络安全.html" class="nav-link">网络安全</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/other/git/git命令全集.html" class="nav-link">其他相关</a></li></ul></div></div><div class="nav-item"><a href="/blogs/views/no.1/" class="nav-link">面试</a></div><div class="nav-item"><a href="https://github.com/ColaStar/blogs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blogs/views/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/views/no.0/js/es6.html" class="nav-link">前端基础</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/javascript-QA/javascriptqa.html" class="nav-link">javaScript与测试工程师</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.1/函数式编程/函数式编程.html" class="nav-link">编程相关</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.2/http.html" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.3/webpack.html" class="nav-link">前端自动化</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.4/前端性能优化.html" class="nav-link">前端优化</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.5/css工作流.html" class="nav-link">css相关</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.6/react/react.html" class="nav-link">框架相关</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.7/计算机组成原理.html" class="nav-link">计算机组成原理</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.8/数据结构与算法.html" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/node/node/node.html" class="nav-link">node相关</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/no.10/网络安全.html" class="nav-link">网络安全</a></li><li class="dropdown-item"><!----> <a href="/blogs/views/other/git/git命令全集.html" class="nav-link">其他相关</a></li></ul></div></div><div class="nav-item"><a href="/blogs/views/no.1/" class="nav-link">面试</a></div><div class="nav-item"><a href="https://github.com/ColaStar/blogs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blogs/views/no.5/cssHoudini.html" class="active sidebar-link">CSS魔术师Houdini</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/views/no.5/cssHoudini.html#css-houdini" class="sidebar-link">CSS Houdini</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.5/cssHoudini.html#houdini-api介绍" class="sidebar-link">Houdini API介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/views/no.5/cssHoudini.html#css-properties-and-values-api" class="sidebar-link">CSS Properties and Values API</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.5/cssHoudini.html#box-tree-api" class="sidebar-link">Box Tree API</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.5/cssHoudini.html#css-layout-api" class="sidebar-link">CSS Layout API</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.5/cssHoudini.html#css-painting-api" class="sidebar-link">CSS Painting API</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.5/cssHoudini.html#worklets" class="sidebar-link">Worklets</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.5/cssHoudini.html#css-parser-api" class="sidebar-link">CSS Parser API</a></li><li class="sidebar-sub-header"><a href="/blogs/views/no.5/cssHoudini.html#css-typed-om" class="sidebar-link">CSS Typed OM</a></li></ul></li></ul></li><li><a href="/blogs/views/no.5/css工作流.html" class="sidebar-link">css工作流</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="css魔术师houdini"><a href="#css魔术师houdini" aria-hidden="true" class="header-anchor">#</a> CSS魔术师Houdini</h1> <p>在现今的 Web 开发中，JavaScript 几乎占据所有版面，除了控制页面逻辑与操作 DOM 对象以外，连 CSS 都直接写在 JavaScript 里面了，就算浏览器都还沒有实现的特性，总会有人做出对应的 Polyfills，让你快速的将新 Feature 应用到 Production 环境中，更別提我们还有 Babel 等工具帮忙转译。</p> <p>而 CSS 就不同了，除了制定 CSS 标准规范所需的时间外，各家浏览器的版本、实战进度差异更是旷日持久，再加上 CSS 并非 Javascript 这样的动态语言，我们无法简单的提供 Polyfills，顶多利用 PostCSS、Sass 等工具來帮我們转译出浏览器能接受的 CSS，而剩下的就是浏览器的事了。</p> <p>这边让我们回想一下，浏览器在网頁的渲染过程中，做了哪些事情？</p> <p><a data-fancybox="" title="" href="https://colastar.github.io/static/images/css-浏览器.png"><img src="https://colastar.github.io/static/images/css-%E6%B5%8F%E8%A7%88%E5%99%A8.png" alt=""></a></p> <p>浏览器的 Render Pipeline 中，JavaScript 与 Style 两个阶段会解析 HTML 并为加载的 JS 与 CSS 建立 Render Tree，也就是所谓的 DOM 与 CSSOM</p> <p><a data-fancybox="" title="" href="https://colastar.github.io/static/images/css-浏览器1.png"><img src="https://colastar.github.io/static/images/css-%E6%B5%8F%E8%A7%88%E5%99%A81.png" alt=""></a></p> <p>而就现阶段的 Web 技术來看，开发者们能操作的就是通过 JS 去控制 DOM 与 CSSOM，來来影响页面的变化，但是对于接下來的 Layout、Paint 与 Composite 就几乎沒有控制权了。</p> <p>既无法让各家浏览器快速并统一实战规格，亦不能轻易产生 Polyfills，所以到现在我们依然无法大胆使用 Flexbox，即便它早在 2009 年就被提出了…</p> <p>但 CSS 并非就此驻足不前。</p> <p>为了解決上述问题，为了让 CSS 的魔力不再浏览器把持，Houdini 就诞生了！（ Houdini 是美国的伟大魔术师，擅长逃脱术，很适合想将 CSS 从浏览器中解放的概念）</p> <h2 id="css-houdini"><a href="#css-houdini" aria-hidden="true" class="header-anchor">#</a> CSS Houdini</h2> <p>CSS Houdini 是由一群來自 Mozilla, Apple, Opera, Microsoft, HP, Intel, IBM, Adobe 与 Google 的工程 师所组成的工作小组，志在建立一系列的 API，让开发者能够介入浏览器的 CSS engine，帶给开发者更多的解決方案，用来解決 CSS 长久以来的问题：</p> <ul><li>Cross-Browser isse</li> <li>CSS Polyfill 的制作困难</li></ul> <p>Houdini task force 目前起草了一些 API 规范，并逐步努力让其通过 W3C，成为真正的 Web standards。 由于都是草稿阶段，有些甚至只有规画，还未被真正写入规范，所以变动很大，有些我也不是很了解，所以就大致介绍一下，若有错误拜托务必告知！</p> <p>另外，有兴趣的读者可以直接从这里 <a href="https://dev.w3.org/houdini/" target="_blank" rel="noopener noreferrer">CSS Houdini Drafts<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 看详细內容（ Drafts 的更新时间都非常近期，活跃中的草稿！）。</p> <p>下面这张图我将 Google 提供的 Render pipeline 与 Houdini: Maybe The Most Exciting Development In CSS You’ve Never Heard Of 中提到的 pipeline 做个结合对比，显示出 Houdini 试图在浏览器的 Render pipeline 中提供哪些 API 给开发者使用：</p> <p><a data-fancybox="" title="" href="https://colastar.github.io/static/images/css-浏览器2.png"><img src="https://colastar.github.io/static/images/css-%E6%B5%8F%E8%A7%88%E5%99%A82.png" alt=""></a></p> <p>其中灰色部分就是只在规划阶段，而黃色部份就是已经写入规范正在推行中.</p> <h2 id="houdini-api介绍"><a href="#houdini-api介绍" aria-hidden="true" class="header-anchor">#</a> Houdini API介绍</h2> <blockquote><p>Parser、Paint、Layout API扩展css的词法分析器</p></blockquote> <ul><li><p><code>CSS Parser API</code> 还没有被写⼊规范，所以下⾯我要说的内容 随时都会有变化，但是它的基本思想不会变:允许开发者⾃由扩展 CSS 词法分析器，引入新的结构(constructs)， ⽐如新的媒体规则、新的伪类、嵌套、<code>@extends</code>、 <code>@apply</code> 等等。只要新的词法分析器知道如何 解析这些新结构，CSSOM 就 不会直接忽略略它们，⽽而把这 些结构放到正确的地⽅方。</p></li> <li><p><code>CSS Layout API</code>允许开发 者可以通过 <strong>CSS Layout API</strong> 实现自己的布局模块 (layout module)，这⾥ 的“布局模块”指的是 <code>display</code> 的属性值。也就是 说，这个 API 实现以后， 开发者⾸次拥有了像 CSS 原⽣代码(比如 <code>display:flex、 display:table</code>)那样的布 局能力。</p></li></ul> <h3 id="css-properties-and-values-api"><a href="#css-properties-and-values-api" aria-hidden="true" class="header-anchor">#</a> CSS Properties and Values API</h3> <p>先介绍一个最能够使用的 API，除了 IE family 以外，Chrome、Firefox 与 Safari 都已经能夠直接使用了！ <a href="https://caniuse.com/#search=custom%20properties" target="_blank" rel="noopener noreferrer">caniuse<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>相信很多人都使用过 CSS Preprocessors，他给予开发者在 CSS 中使用变量的能力：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$font-size: 10px;
$brightBlue: blue;
.mark{
    font-size: 1.5 * $font-size;
    color: $brightBlue
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>但其实使用 <code>Preprocessors</code> 还是有其缺点，像是不同的 <code>Preprocessors</code> 就有不同的 <code>Syntax</code>，需要额外 <code>setup</code> 与 <code>compile</code>， 而现在 CSS 已经有原生的变量可以使用了！就是 <strong>CSS Properties and Values API！</strong></p> <p>SCSS 与 Native CSS Custom Properties 的一个主要差別可以看下图：
<a data-fancybox="" title="" href="https://colastar.github.io/static/images/scss-vs-css.png"><img src="https://colastar.github.io/static/images/scss-vs-css.png" alt=""></a></p> <p>原生的 CSS variable syntax：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>/* declaration */
--VAR_NAME: &lt;declaration-value&gt;;
/* usage */
var(--VAR_NAME)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>变量可以定义在 root element selector 內，也能在一般 selector 內，甚至是给別的变量 reuse：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>/* root element selector (全域) */
:root {
    --main-color: #ff00ff;
    --main-bg: rgb(200, 255, 255);
    --block-font-size: 1rem;
}
.btn__active::after{
    --btn-text: 'This is btn';
    /* 相等於 --box-highlight-text:'This is btn been actived'; */
    --btn-highlight-text: var(--btn-text)' been actived';
    content: var(--btn-highlight-text);
    /* 也能使用 calc 來做運算 */
    font-size: calc(var(--block-font-size)*1.5);
}
body {
    /* variable usage */
    color: var(--main-color);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>而有了变量以后，会为 CSS 带來什么好处应该很明显，他的 Use case 可以多写一篇文章來介绍了，或是可以直接看這篇的详细介绍，我这边介绍几个我觉得比较有趣的：</p> <p>模拟一个特殊的 CSS rule:</p> <p>单纯透过更改变量來达到改变 <code>box-shadow</code> 颜色</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>.textBox {
    --box-shadow-color: yellow;
    box-shadow: 0 0 30px var(--box-shadow-color);
}
.textBox:hover {
    /* box-shadow: 0 0 30px green; */
    --box-shadow-color: green;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>此外，我们也可以用 JavaScript 来控制：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const textBox = document.querySelector('.textBox');
// GET
const Bxshc = getComputedStyle(textBox).getPropertyValue('--box-shadow-color');
// SET
textBox.style.setProperty('--box-shadow-color', 'new color');
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>非常好用的特性，几乎所有主流浏览器都已经支持了，大家快来使用吧！</p> <h3 id="box-tree-api"><a href="#box-tree-api" aria-hidden="true" class="header-anchor">#</a> Box Tree API</h3> <p>Box tree API 并沒有出现在上图中，但在 Paintin API 中会用到其概念。</p> <p>大家都知道在 DOM tree 中的每个元素都有一个 Box Modal，而在浏览器解析过程中，还会将其拆分成 fragments，至于什么是 <code>fragments</code>？以 drafts 中的例子來解释：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//html
&lt;div class=&quot;wrapper&quot;&gt;
&lt;p&gt;foo &lt;i&gt;bar baz&lt;/i&gt;&lt;/p&gt;
&lt;/div&gt;

//css
p::first-line { color: green; }

p::first-letter { color: red; }

.wrapper {
  width: 60px;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>上面的 HTML 总共就会拆出七个 <code>fragments：</code></p> <ul><li>最外层的 div</li> <li>第一行的 box (包含 foo bar)</li> <li>第二行的 box (包含 baz)</li> <li>吃到 ::first-line 与 ::first-letter 的 f 也会被拆出來成独立的 fragments</li> <li>只吃到 ::first-line 的 oo 只好也独立出來</li> <li>吃到 ::first-line 与 包在 <code>&lt;i&gt;</code>內的 bar 当然也是</li> <li>在第二行底下且为 italic 的 baz</li></ul> <p>而 Box tree API 目的就是希望让开发者能够取得这些 fragments 的信息，至于取得后要如何使用，基本上应该会跟后面介绍的 Parser API、Layout API 与 Paint API 有关联，当我们能取得详细的 Box Modal 信息时，要客制化 Layout Module 才更为方便。</p> <h3 id="css-layout-api"><a href="#css-layout-api" aria-hidden="true" class="header-anchor">#</a> CSS Layout API</h3> <p>Layout API 顾名思义就是提供开发者撰写自己的 <code>Layout module</code>，Layout module 也就是用来 <code>assign</code> 给 <code>display</code> 属性的值，像是<code>display: grid</code> 或 <code>display: flex</code>。 你只要透过 <code>registerLayout</code> 的 <code>function</code>，传入 <code>Layout</code> 名称与 <code>JS class</code> 来定义 <code>Layout</code> 的逻辑即可，例如我们实战一个 <code>block-like</code> 的 <code>Layout：</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>registerLayout('block-like', class extends Layout {
    static blockifyChildren = true;
    static inputProperties = super.inputProperties;
    *layout(space, children, styleMap) {
        const inlineSize = resolveInlineSize(space, styleMap);
        const bordersAndPadding = resolveBordersAndPadding(constraintSpace, styleMap);
        const scrollbarSize = resolveScrollbarSize(constraintSpace, styleMap);
        const availableInlineSize = inlineSize -
                                    bordersAndPadding.inlineStart -
                                    bordersAndPadding.inlineEnd -
                                    scrollbarSize.inline;
        const availableBlockSize = resolveBlockSize(constraintSpace, styleMap) -
                                bordersAndPadding.blockStart -
                                bordersAndPadding.blockEnd -
                                scrollbarSize.block;
        const childFragments = [];
        const childConstraintSpace = new ConstraintSpace({
            inlineSize: availableInlineSize,
            blockSize: availableBlockSize,
        });
        let maxChildInlineSize = 0;
        let blockOffset = bordersAndPadding.blockStart;
        for (let child of children) {
            const fragment = yield child.layoutNextFragment(childConstraintSpace);
            // 這段控制 Layout 下的 children 要 inline 排列
            // fragment 應該就是前述的 Box Tree API 內提到的 fragment
            fragment.blockOffset = blockOffset;
            fragment.inlineOffset = Math.max(
                bordersAndPadding.inlineStart,
                (availableInlineSize - fragment.inlineSize) / 2);
            maxChildInlineSize =
                Math.max(maxChildInlineSize, childFragments.inlineSize);
            blockOffset += fragment.blockSize;
        }
        const inlineOverflowSize = maxChildInlineSize + bordersAndPadding.inlineEnd;
        const blockOverflowSize = blockOffset + bordersAndPadding.blockEnd;
        const blockSize = resolveBlockSize(
            constraintSpace, styleMap, blockOverflowSize);
        return {
            inlineSize: inlineSize,
            blockSize: blockSize,
            inlineOverflowSize: inlineOverflowSize,
            blockOverflowSize: blockOverflowSize,
            childFragments: childFragments,
        };
    }
});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>上面这段代码是来自 <a href="https://drafts.css-houdini.org/css-layout-api/" target="_blank" rel="noopener noreferrer">Houdini Draft<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的示例，完整放上来是想给大家看一下实战一个 <code>Layout</code> 需要注意的细节有多少，其实并不是如想像中的轻松， 相信未来会出现更多方便的 API 辅助开发。（放心接下来不会再有这么多 code 了 XD）</p> <p>有了 Layout API，不管是自己实战或是拿別人写好的 Layout，你都可以直接如下方式使用：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>.wrapper {
    display: layout('block-like');
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="css-painting-api"><a href="#css-painting-api" aria-hidden="true" class="header-anchor">#</a> CSS Painting API</h3> <p>Painting API 与 Layout 类似，提供一个叫做 <code>registerPaint</code> 的方法：</p> <p>定义 <code>Paint Method</code>，这边偷偷用到了待会要介紹的 <code>CSS Properties</code>：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>registerPaint('simpleRect', class {
    static get inputProperties() { return ['--rect-color']; }
    paint(ctx, size, properties) {
        // 依據 properties 改變顏色
        const color = properties.get('--rect-color');
        ctx.fillStyle = color.cssText;
        ctx.fillRect(0, 0, size.width, size.height);
    }
});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>宣告使用：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>.div-1 {
    --rect-color: red;
    width: 50px;
    height: 50px;
    background-image: paint(simpleRect);
}
.div-2 {
    --rect-color: yellow;
    width: 100px;
    height: 100px;
    background-size: 50% 50%;
    background-image: paint(simpleRect);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>.div-1</code> 与 <code>.div-2</code> 就可以拥有各自定义宽高颜色的方形 <code>background-image</code>。</p> <h3 id="worklets"><a href="#worklets" aria-hidden="true" class="header-anchor">#</a> Worklets</h3> <p>在上述的 <code>Layout API</code> 与 <code>Paint API</code> 中，我们都有撰写一个 JS文件，用来定义新的属性，然后在 CSS 文件中呼叫取用，你可能会觉得那个 JS 文件就直接像一般 Web 嵌入 JS 的方式一样即可， 但实际上并非如此，我们需要通过 <code>Worklets</code> 來帮我們载入。以上面的 Paint API 为例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// add a Worklet
paintWorklet.addModule('simpleRect.js');
// WORKLET &quot;simpleRect.js&quot;
registerPaint('simpleRect', class {
    static get inputProperties() { return ['--rect-color']; }
    paint(ctx, size, properties) {
        // 依據 properties 改變顏色
        const color = properties.get('--rect-color');
        ctx.fillStyle = color.cssText;
        ctx.fillRect(0, 0, size.width, size.height);
    }
});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>同理，Layout API 则是 <code>layoutWorklet.addModule('blockLike.js')</code>。</p> <p><code>Worklets</code> 光名字就有点像 <code>Web Worker</code> 了，都是独立于主要执行者之外，并且不直接与 DOM 互动。你可能会想那为何还需要有一個 Worklets？</p> <p>因为 Houdini 是希望将开发者的程式码 hook 到 CSS engine 中运作，而根据规范內的叙述，web worker 相对笨重，不适合用来处理 CSS engine 這种可能会牵扯到数百万像素图片的工作。</p> <p>所以可以推断，Worklets 的特点就是轻量以及生命周期较短。</p> <p>共实除了 Layout Worklets 与 Paint Worklets 外，还有所谓的 Animation Worklet，虽然还沒有放入规范，但已经有在着手进行中，也有 <a href="https://github.com/GoogleChrome/houdini-samples/tree/master/animation-worklet" target="_blank" rel="noopener noreferrer">Polyfills<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 了，Chrome 的 Sticky Header 就是采用 Houdini 的 Animation Worklet。Twitter 的 <a href="https://blog.hospodarets.com/demos/houdini-anim-twitter/" target="_blank" rel="noopener noreferrer">Header Effect<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 也是采用 Animation Worklet Animation Worklet 是想介入 Render Pipeline 中的 Composite 步骤，也就是原本利用 JS 与 CSS 控制动画时，浏览器会重新执行的部分。</p> <p>关于 Animation Worklet 的详细操作介绍可以看这份PPT: <a href="https://slides.com/malyw/houdini-codemotion#/48" target="_blank" rel="noopener noreferrer">houdini-codemotion<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="css-parser-api"><a href="#css-parser-api" aria-hidden="true" class="header-anchor">#</a> CSS Parser API</h3> <p>Parser API 目前还是处在 Unofficial draft，但我相信如果这个 API 确认的话，对前端开发有绝对的帮助，她的概念是想让开发者能扩充浏览器解析 HTML、CSS 的功能， 也就是说，你可以想办法让他看得懂最新定义的 pseudo-classes 或甚至是 element-queries 等等，这样就能正确解析出 CSSOM，从此不用再等浏览器更新。</p> <h3 id="css-typed-om"><a href="#css-typed-om" aria-hidden="true" class="header-anchor">#</a> CSS Typed OM</h3> <p>CSS Typed OM 就是 CSSOM 的強化版，最主要的功能在于将 CSSOM 所使用的字串值转换成具有型別意义的 JavaScript 表示形态，像是所有的 CSS Values 都有一个 base class interface：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>interface CSSStyleValue {
    stringifier;
    static CSSStyleValue? parse(DOMString property, DOMString cssText);
    static sequence&lt;CSSStyleValue&gt;? parseAll(DOMString property, DOMString cssText);
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>你可以如下操作 CSS style: <a href="https://slides.com/malyw/houdini-codemotion#/27" target="_blank" rel="noopener noreferrer">(source from CSS Houdini- the bridge between CSS, JavaScript and the browser)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// CSS -&gt; JS
const map = document.querySelector('.example').styleMap;
console.log( map.get('font-size') );
// CSSSimpleLength {value: 12, type: &quot;px&quot;, cssText: &quot;12px&quot;}
// JS -&gt; JS
console.log( new CSSUnitValue(5, &quot;px&quot;) );
// CSSUnitValue{value:5,unit:&quot;px&quot;,type:&quot;length&quot;,cssText:&quot;5px&quot;}
// JS -&gt; CSS
// set style &quot;transform: translate3d(0px, -72.0588%, 0px);&quot;
elem.outputStyleMap.set('transform',
    new CSSTransformValue([
        new CSSTranslation(
        0, new CSSSimpleLength(100 - currentPercent, '%'), 0
        )]));
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>根据 <a href="https://drafts.css-houdini.org/css-typed-om/" target="_blank" rel="noopener noreferrer">Drafts<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的內容，有了型別定义，在 JavaScript 的操作上据说会有性能上的显著提升。此外，CSS Typed OM 也应用在 Parser API 与 CSS Properties API 上。</p> <p>Font Metrics API
Font Metrics 也沒有出現在上方的 Houdini API on render pipeline 中，但它其实已经被写入 Draft 规范 中了。</p> <p>老实说看不是很懂他的 spec 写的內容，但我猜测这东西的用途应该跟这篇文章 <a href="https://iamvdo.me/en/blog/css-font-metrics-line-height-and-vertical-align" target="_blank" rel="noopener noreferrer">Deep dive CSS: font metrics, line-height and vertical-align<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 其中提到一个问题有关，（里面非常详细的介绍了 font metrics、line-height 与 vertical-align 在网页上如何互相影响，推荐大家有空的话耐心阅读一番。）：</p> <p>不同 <code>font-family</code> 在相同 <code>font-size</code> 下，所产生的 <code>span</code> 高度会不同。</p> <p>要想控制 Font metrics，也就是控制字所占的宽高的话，目前可以先用 CSS Properties 來处理，根据已知字体的 font-metrics 动态算出我们要 apply 多少的 font-size：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>p {
    /* 定義好我們已知字型的 Font metrics */
    /* font metrics */
    --font: Catamaran;
    --fm-capitalHeight: 0.68;
    --fm-descender: 0.54;
    --fm-ascender: 1.1;
    --fm-linegap: 0;
    /* 定義想要的高度 */
    --capital-height: 100;
    /* 設定 font-family */
    font-family: var(--font);
    /* 利用 Font metrics 的資訊與想定義的高度來計算出 font-size */
    --computedFontSize: (var(--capital-height) / var(--fm-capitalHeight));
    font-size: calc(var(--computedFontSize) * 1px);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>而想必 <code>Font Metrics API</code>就是希望能 expose 出更方便的 API 來达成上述的事情。</p> <p>总结</p> <p>手动拼接字符串和各种奇怪错误的日子已经结束了!</p> <ul><li>更少的bug。例如数字值总是以数字形式返回，而不是字符串。</li> <li>el.style.opacity += 0.1; el.style.opacity === '0.30.1' // dragons!</li> <li>算术运算和单位转换。在绝对长度单位(例如 px -&gt; cm)之间进行转换并进行基本的数学运算。</li> <li>数值范围限制和舍入。Typed OM 通过对值进行范围限制和舍入，以使其在属性的可接受范围内。</li> <li>更好的性能。浏览器必须做更少的工作序列化和反序列化字符串值。现在，对于 CSS 值，引擎可以对 JS
和 C++ 使用相似的理解。Tab Akins 已经展示了一些早期的性能基准测试，与使用旧的 CSSOM 和字符串相 比，Typed OM 的运行速度快了 ~30%。这对使用 requestionAnimationFrame() 处理快速 CSS 动画可能很重 要 。crbug.com/808933 可以追踪 Blink 的更多性能演示。</li> <li>错误处理。新的解析方法带来了 CSS 世界中的错误处理。</li> <li>“我应该使用骆驼式的 CSS 名称还是字符串呢?” 你不再需要猜测名字是骆驼还或字符串(例如 el.style.backgroundColor vs el.style['background-color'])。Typed OM 中的 CSS 属性名称始终是字符串，与 您实际在 CSS 中编写的内容一致:)</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">1/13/2020, 2:40:21 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blogs/views/no.5/css工作流.html">
          css工作流
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blogs/views/assets/js/app.124666f5.js" defer></script><script src="/blogs/views/assets/js/2.d340cefd.js" defer></script><script src="/blogs/views/assets/js/86.aa8119ea.js" defer></script>
  </body>
</html>
