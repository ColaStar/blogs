(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{208:function(n,s,e){"use strict";e.r(s);var t=e(0),a=Object(t.a)({},function(){var n=this,s=n.$createElement,e=n._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h1",{attrs:{id:"flux-架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#flux-架构","aria-hidden":"true"}},[n._v("#")]),n._v(" Flux 架构")]),n._v(" "),e("p",[e("code",[n._v("Flux")]),n._v("是由一群Facebook工程师提出的，它的名字是拉丁语的Flow。Flux的提出主"),e("strong",[n._v("要是针对现有前端MVC框架的局限")]),n._v("总结出来的一套基于"),e("code",[n._v("dispatcher")]),n._v("的前端应用架构模式。按照MVC的命名习惯，他应该叫ADSV（Action Dispatcher Store View）。")]),n._v(" "),e("p",[n._v("Flux的核心思想就是数据和逻辑永远单向流动。")]),n._v(" "),e("h2",{attrs:{id:"flux-是什么？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#flux-是什么？","aria-hidden":"true"}},[n._v("#")]),n._v(" Flux 是什么？")]),n._v(" "),e("ul",[e("li",[e("p",[e("code",[n._v("Flux")]),n._v("是一种架构思想，专门是用来解决软件的结构问题。它跟MVC架构是同一类东西，但是更加简单和清晰。")])]),n._v(" "),e("li",[e("p",[e("code",[n._v("Flux")]),n._v("存在多种实现（至少24种）react是其中的一种，")])]),n._v(" "),e("li",[e("p",[e("code",[n._v("react")]),n._v("本身只设计"),e("code",[n._v("UI")]),n._v("层，如果搭建大型应用，必须搭配一个前端框架。")])])]),n._v(" "),e("blockquote",[e("p",[n._v("Flux将一个应用分成四个部分")])]),n._v(" "),e("ul",[e("li",[e("p",[e("code",[n._v("View")]),n._v("：视图层。")])]),n._v(" "),e("li",[e("p",[e("code",[n._v("Action")]),n._v("（动作）：视图层发出消息（比如"),e("code",[n._v("click")]),n._v("），它主要包含一个actionType属性（说明动作的类型）和一些其他属性（用来传递数据）")])]),n._v(" "),e("li",[e("p",[e("code",[n._v("Dispatcher")]),n._v("(派发器)：用来接收Action,将 Action 派发到 Store,并执行回调函数,Dispatcher 只能有一个，而且是全局的。")])]),n._v(" "),e("li",[e("p",[e("code",[n._v("store")]),n._v("（数据层）：负责保存数据，并定义修改数据的逻辑，同时调用"),e("code",[n._v("dispatcher")]),n._v("的"),e("code",[n._v("register")]),n._v("方法将自己注册称为一个监听器。这样每当我们使用"),e("code",[n._v("dispatcher")]),n._v("的"),e("code",[n._v("dispatch")]),n._v("方法分发一个"),e("code",[n._v("action")]),n._v("时，"),e("code",[n._v("store")]),n._v("注册的监听器就会被调用，同时得到这个"),e("code",[n._v("action")]),n._v("作为参数。"),e("strong",[n._v("简单点说")]),n._v("：就是用来存放应用的状态，根据 action 的 type 字段来确定是否响应这个 action。若需要响应，则会根据 action中的信息修改 store 中的数据,并触发一个更新事件,去更新页面。")])])]),n._v(" "),e("p",[e("img",{attrs:{src:"flux.png",alt:""}}),n._v("\n从上图可以看出")]),n._v(" "),e("p",[n._v("在"),e("code",[n._v("Flux")]),n._v("应用中，数据从"),e("code",[n._v("action")]),n._v("到"),e("code",[n._v("dispatcher")]),n._v("，再到"),e("code",[n._v("store")]),n._v("，最终到"),e("code",[n._v("view")]),n._v("的路线是单向不可逆的，各个角色之间不会像前端MVC模式那样存在交错的连线。")]),n._v(" "),e("h2",{attrs:{id:"单向流动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#单向流动","aria-hidden":"true"}},[n._v("#")]),n._v(" 单向流动")]),n._v(" "),e("p",[e("code",[n._v("Flux")]),n._v(' 的最大特点，就是数据的"'),e("strong",[n._v("单向流动")]),n._v('"。')]),n._v(" "),e("ul",[e("li",[n._v("用户访问 View")]),n._v(" "),e("li",[e("code",[n._v("View")]),n._v(" 发出用户的 "),e("code",[n._v("Action")])]),n._v(" "),e("li",[e("code",[n._v("Dispatcher")]),n._v(" 收到 "),e("code",[n._v("Action")]),n._v("，要求 "),e("code",[n._v("Store")]),n._v(" 进行相应的更新,即"),e("code",[n._v("dispatcher")]),n._v("负责分发事件")]),n._v(" "),e("li",[e("code",[n._v("Store")]),n._v(' 更新后，发出一个"'),e("code",[n._v("change")]),n._v('"事件,即Store是负责保存数据，同时响应事件并更新数据')]),n._v(" "),e("li",[e("code",[n._v("View")]),n._v(' 收到"'),e("code",[n._v("change")]),n._v('"事件后，更新页面，简单点说就是'),e("code",[n._v("View")]),n._v("负责订阅"),e("code",[n._v("store")]),n._v("中的数据，并使用这些数据渲染相应的页面。")])]),n._v(" "),e("p",[e("img",{attrs:{src:"flux1.png",alt:""}})]),n._v(" "),e("p",[n._v('数据总是"'),e("strong",[n._v("单向流动")]),n._v('"，任何相邻的部分都不会发生数据的"双向流动"。这保证了流程的清晰')]),n._v(" "),e("h2",{attrs:{id:"补充"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#补充","aria-hidden":"true"}},[n._v("#")]),n._v(" 补充")]),n._v(" "),e("ul",[e("li",[e("code",[n._v("Dispatcher")]),n._v("的主要API：")]),n._v(" "),e("li",[e("code",[n._v("register(function callback)")]),n._v("：注册callback回调。")]),n._v(" "),e("li",[e("code",[n._v("unregister(string id)")]),n._v("：卸载回调方法。")]),n._v(" "),e("li",[e("code",[n._v("waitFor(array<string> ids)")]),n._v("：在继续执行当前回调之前，等待指定要调用的回调，这个方法只能被回调用于响应分派的有效载荷。")]),n._v(" "),e("li",[e("code",[n._v("dispatch(object payload)")]),n._v("： 将有效载荷调度到所有注册的回调。")]),n._v(" "),e("li",[e("code",[n._v("isDispatching()：Dispatcher")]),n._v(" 是否正在派发任务。")])]),n._v(" "),e("h2",{attrs:{id:"例子"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#例子","aria-hidden":"true"}},[n._v("#")]),n._v(" 例子")]),n._v(" "),e("blockquote",[e("p",[n._v("View（第一部分）\n请打开 Demo 的首页index.jsx ，你会看到只加载了一个组件。")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("// index.jsx\nvar React = require('react');\nvar ReactDOM = require('react-dom');\nvar MyButtonController = require('./components/MyButtonController');\n\nReactDOM.render(\n  <MyButtonController/>,\n  document.querySelector('#example')\n);\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br")])]),e("p",[n._v("上面代码中，你可能注意到了，组件的名字不是 MyButton，而是 MyButtonController。这是为什么？")]),n._v(" "),e("p",[n._v('这里，我采用的是 React 的 controller view 模式。"controller view"组件只用来保存状态，然后将其转发给子组件。MyButtonController的源码很简单。')]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("// components/MyButtonController.jsx\nvar React = require('react');\nvar ButtonActions = require('../actions/ButtonActions');\nvar MyButton = require('./MyButton');\n\nvar MyButtonController = React.createClass({\n  createNewItem: function (event) {\n    ButtonActions.addNewItem('new item');\n  },\n\n  render: function() {\n    return <MyButton\n      onClick={this.createNewItem}\n    />;\n  }\n});\n\nmodule.exports = MyButtonController;\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br")])]),e("p",[n._v("上面代码中，MyButtonController将参数传给子组件MyButton。后者的源码甚至更简单。")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("// components/MyButton.jsx\nvar React = require('react');\n\nvar MyButton = function(props) {\n  return <div>\n    <button onClick={props.onClick}>New Item</button>\n  </div>;\n};\n\nmodule.exports = MyButton;\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br")])]),e("p",[n._v("上面代码中，你可以看到"),e("code",[n._v("MyButton")]),n._v('是一个纯组件（即不含有任何状态），从而方便了测试和复用。这就是"'),e("code",[n._v("controll view")]),n._v('"模式的最大优点。')]),n._v(" "),e("p",[e("code",[n._v("MyButton")]),n._v("只有一个逻辑，就是一旦用户点击，就调用"),e("code",[n._v("this.createNewItem")]),n._v(" 方法，向"),e("code",[n._v("Dispatcher")]),n._v("发出一个"),e("code",[n._v("Action")]),n._v("。")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("// components/MyButtonController.jsx\n\n  // ...\n  createNewItem: function (event) {\n    ButtonActions.addNewItem('new item');\n  }\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br")])]),e("p",[n._v("上面代码中，调用"),e("code",[n._v("createNewItem")]),n._v("方法，会触发名为"),e("code",[n._v("addNewItem")]),n._v("的"),e("code",[n._v("Action")]),n._v("。")]),n._v(" "),e("blockquote",[e("p",[n._v("Action")])]),n._v(" "),e("p",[n._v("每个"),e("code",[n._v("Action")]),n._v("都是一个对象，包含一个"),e("code",[n._v("actionType")]),n._v("属性（说明动作的类型）和一些其他属性（用来传递数据）。")]),n._v(" "),e("p",[n._v("在这个Demo里面，"),e("code",[n._v("ButtonActions")]),n._v(" 对象用于存放所有的"),e("code",[n._v("Action")]),n._v("。")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("// actions/ButtonActions.js\nvar AppDispatcher = require('../dispatcher/AppDispatcher');\n\nvar ButtonActions = {\n  addNewItem: function (text) {\n    AppDispatcher.dispatch({\n      actionType: 'ADD_NEW_ITEM',\n      text: text\n    });\n  },\n};\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br")])]),e("p",[n._v("上面代码中，"),e("code",[n._v("ButtonActions.addNewItem")]),n._v("方法使用"),e("code",[n._v("AppDispatcher")]),n._v("，把动作"),e("code",[n._v("ADD_NEW_ITEM")]),n._v("派发到"),e("code",[n._v("Store")]),n._v("。")]),n._v(" "),e("blockquote",[e("p",[n._v("Dispatcher\n"),e("code",[n._v("Dispatcher")]),n._v(" 的作用是将 "),e("code",[n._v("Action")]),n._v(" 派发到 "),e("code",[n._v("Store")]),n._v("。你可以把它看作一个路由器，负责在 "),e("code",[n._v("View")]),n._v(" 和 "),e("code",[n._v("Store")]),n._v(" 之间，建立 "),e("code",[n._v("Action")]),n._v(" 的正确传递路线。注意，"),e("code",[n._v("Dispatcher")]),n._v(" 只能有一个，而且是全局的。")])]),n._v(" "),e("p",[n._v("Facebook官方的 "),e("code",[n._v("Dispatcher")]),n._v(" 实现输出一个类，你要写一个AppDispatcher.js，生成 "),e("code",[n._v("Dispatcher")]),n._v(" 实例。")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("// dispatcher/AppDispatcher.js\nvar Dispatcher = require('flux').Dispatcher;\nmodule.exports = new Dispatcher();\nAppDispatcher.register()方法用来登记各种Action的回调函数。\n\n\n// dispatcher/AppDispatcher.js\nvar ListStore = require('../stores/ListStore');\n\nAppDispatcher.register(function (action) {\n  switch(action.actionType) {\n    case 'ADD_NEW_ITEM':\n      ListStore.addNewItemHandler(action.text);\n      ListStore.emitChange();\n      break;\n    default:\n      // no op\n  }\n})\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br")])]),e("p",[n._v("上面代码中，"),e("code",[n._v("Dispatcher")]),n._v("收到"),e("code",[n._v("ADD_NEW_ITEM")]),n._v("动作，就会执行回调函数，对"),e("code",[n._v("ListStore")]),n._v("进行操作。")]),n._v(" "),e("p",[n._v("记住，"),e("code",[n._v("Dispatcher")]),n._v(" 只用来派发 "),e("code",[n._v("Action")]),n._v("，不应该有其他逻辑。")]),n._v(" "),e("blockquote",[e("p",[n._v("Store\n"),e("code",[n._v("Store")]),n._v(" 保存整个应用的状态。它的角色有点像 "),e("code",[n._v("MVC")]),n._v(" 架构之中的"),e("code",[n._v("Model")]),n._v(" 。")])]),n._v(" "),e("p",[n._v("在我们的 Demo 中，有一个ListStore，所有数据都存放在那里。")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("// stores/ListStore.js\nvar ListStore = {\n  items: [],\n\n  getAll: function() {\n    return this.items;\n  },\n\n  addNewItemHandler: function (text) {\n    this.items.push(text);\n  },\n\n  emitChange: function () {\n    this.emit('change');\n  }\n};\n\nmodule.exports = ListStore;\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br")])]),e("p",[n._v("上面代码中，"),e("code",[n._v("ListStore.items")]),n._v("用来保存条目，"),e("code",[n._v("ListStore.getAll()")]),n._v("用来读取所有条目，"),e("code",[n._v("ListStore.emitChange()")]),n._v('用来发出一个"change"事件。')]),n._v(" "),e("p",[n._v("由于 "),e("code",[n._v("Store")]),n._v(" 需要在变动后向 "),e("code",[n._v("View")]),n._v(' 发送"'),e("code",[n._v("change")]),n._v('"事件，因此它必须实现事件接口。')]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("// stores/ListStore.js\nvar EventEmitter = require('events').EventEmitter;\nvar assign = require('object-assign');\n\nvar ListStore = assign({}, EventEmitter.prototype, {\n  items: [],\n\n  getAll: function () {\n    return this.items;\n  },\n\n  addNewItemHandler: function (text) {\n    this.items.push(text);\n  },\n\n  emitChange: function () {\n    this.emit('change');\n  },\n\n  addChangeListener: function(callback) {\n    this.on('change', callback);\n  },\n\n  removeChangeListener: function(callback) {\n    this.removeListener('change', callback);\n  }\n});\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br")])]),e("p",[n._v("上面代码中，ListStore继承了EventEmitter.prototype，因此就能使用"),e("code",[n._v("ListStore.on()")]),n._v("和"),e("code",[n._v("ListStore.emit()")]),n._v("，来监听和触发事件了。")]),n._v(" "),e("p",[e("code",[n._v("Store")]),n._v(" 更新后 "),e("code",[n._v("this.addNewItemHandler()")]),n._v(" 发出事件 "),e("code",[n._v("this.emitChange()")]),n._v("，表明状态已经改变。 "),e("code",[n._v("View")]),n._v(" 监听到这个事件，就可以查询新的状态，更新页面了。")]),n._v(" "),e("blockquote",[e("p",[n._v("View （第二部分）\n现在，我们再回过头来修改 "),e("code",[n._v("View")]),n._v(" ，让它监听 "),e("code",[n._v("Store")]),n._v(" 的 "),e("code",[n._v("change")]),n._v(" 事件。")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("// components/MyButtonController.jsx\nvar React = require('react');\nvar ListStore = require('../stores/ListStore');\nvar ButtonActions = require('../actions/ButtonActions');\nvar MyButton = require('./MyButton');\n\nvar MyButtonController = React.createClass({\n  getInitialState: function () {\n    return {\n      items: ListStore.getAll()\n    };\n  },\n\n  componentDidMount: function() {\n    ListStore.addChangeListener(this._onChange);\n  },\n\n  componentWillUnmount: function() {\n    ListStore.removeChangeListener(this._onChange);\n  },\n\n  _onChange: function () {\n    this.setState({\n      items: ListStore.getAll()\n    });\n  },\n\n  createNewItem: function (event) {\n    ButtonActions.addNewItem('new item');\n  },\n\n  render: function() {\n    return <MyButton\n      items={this.state.items}\n      onClick={this.createNewItem}\n    />;\n  }\n});\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br"),e("span",{staticClass:"line-number"},[n._v("37")]),e("br"),e("span",{staticClass:"line-number"},[n._v("38")]),e("br")])]),e("p",[n._v("上面代码中，你可以看到当"),e("code",[n._v("MyButtonController")]),n._v(" 发现 "),e("code",[n._v("Store")]),n._v(" 发出 "),e("code",[n._v("change")]),n._v(" 事件，就会调用 "),e("code",[n._v("this._onChange")]),n._v(" 更新组件状态，从而触发重新渲染。")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("// components/MyButton.jsx\nvar React = require('react');\n\nvar MyButton = function(props) {\n  var items = props.items;\n  var itemHtml = items.map(function (listItem, i) {\n    return <li key={i}>{listItem}</li>;\n  });\n\n  return <div>\n    <ul>{itemHtml}</ul>\n    <button onClick={props.onClick}>New Item</button>\n  </div>;\n};\n\nmodule.exports = MyButton;\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br")])]),e("p",[n._v("参考：http://www.ruanyifeng.com/blog/2016/01/flux.html")])])},[],!1,null,null,null);s.default=a.exports}}]);