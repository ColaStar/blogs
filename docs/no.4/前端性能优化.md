# 前端性能优化

- 浏览器渲染过程
- DNS详解
- TCP三次握手🤝
- HTTP缓存机制
- CDN与集群

## 浏览器渲染过程

![](Navigation_Timing.png)

W3C专门定义的api（嵌入关键节点的API）就是浏览器渲染的标准过程。

Navigation_Timing可以帮助我们调试。

过程大体可以分为三层，如下图：

![](navgation_timing1.png)
- 敲下回车

- 1.prompt forunload（提示卸载）

当新的页面要被请求的时候，把旧的页面干掉，当然还是没有去请求新的页面。

开始navigation

- redirect

首先做本地重定向（查本地是否有缓存）,
并行操作unload（卸载）把上一个页面干掉，重缓存里边取新的页面。

- 3.App cache

开始拿资源

没过期从本地拿然后直接processing最后交给渲染器，显卡去。

如果缓存过期了，进行网络请求资源。走到网络层

- DNS域名解析

domainnLookupStart与domainnLookupEnd

- 建立TCP链接
connectstart tcp链接
secureConnectStart  ssl加密链接开始

- http流程
requrest与response
这块受网络状态，数据量大小，CDN技术的就近原则
响应结束

- processing（资源回来了，一个html）只是一个文本文件。

把文档放到内存里，把文档解析成dom结构对象，把dom结构内的内嵌资源加载，进行请求，dom内容加载完毕后，生成渲染页面的dom的树结构，文档处理完了，开始处理事件，第一个事件是onload事件，
- onload

- 开始render页面怎么显示交给显卡去操作

## DNS详解

DNS是Domain Name System ，域名系统

他就是用来做域名转换的

### 1.顶级域名

比如百度  `baidu.com`

www.baidu.com www其实是二级域名

后缀 .com/.cn/.net等

### 2.域名服务器
若干个级别
### 3.域名解析
![](dns.png)
俩种方式：

1.正向解析：域名到IP

2.反向解析ip到域名

> 解析过程：
1.客户端到运营商服务器

2.首先查缓存

3.如果没有，去找根服务器（17台），他的作用返回后缀，告诉你通过.com去某台TLD server进行下次查询

4.TLD server（只保存着顶级域名的name server地址）解析顶级域名（.com的TLD/.cn的TLD）

5.name server查到最终的url，即解析到他的2.3.4.5....级域名

> dns优化

优化是在运营商那而做一个大的缓存

> 注意：

阿里云是一整套全部包括了，而不是name server



### 域名资源记录

记录类型
![](dns_histrory.png)
注意：

- A记录主要是解析ipv4的；
- ipv6主机记录用来解析ipv6
- 切换服务器时更改，cname的妙用
正常是所有的域名指向vps即多个A记录，如果用cname的话要一个A记录其他都是cname了

![](dns_historoy2.png)

## TCP三次握手与四次挥手

![](tcp三次握手与四次挥手.png)

发送数据包的时候，数据包向下传递的时候逐层回家一个头，应用层->表示层->会话层 传输层 网络层 数据链路层 物理层（010101）->数据链路层 网络层 传输层 回话层 表示层 应用层

相当于加封再解封的过程。

像一个洋葱，一层一层的往外包

这个头有什么用？验证，为本层次服务，每一层都有自己的顺序号。

相当于是快递公司一样

TCP协议模型的详解

![](TCP协议模型的详解)

ping命令用的ICMP协议（数据报协议）
![](tcp协议头)
tcp协议头至少要占24个字节。这些数据都是2进制数据（因为2进制数据紧凑），http是文档。

source：源端口，占2个字节，最大值2的16次方减1

destinationPort 服务端口（目的端口）默认端口80，必须是80端口，如果不是，tcp不认，占2个字节最大值2的16次方减1

sequence Number：顺序号（整型），为啥要编号呢？因为数据是被分割开逐个传输，如果中间丢包的话，服务器可以通过顺序号去判断是否重新补包，后边再组装，这样可以保证及时性和可靠性，占4个字节，最大值2的32次方。就向搬家一样给家具编号。

Acknowledgment Number 应答号：
这个号码可以干嘛呢？  如果丢包了 接收端发给发送端的丢包编码。

offset 偏移量（决定头的大小）

## tcp与udp的区别

tcp相当于打电话
拨号 接起电话 你喂 对方回应喂 然后说话 你说挂，看还有什么没做，他说没没了挂吧 然后挂

udp只管发，发没发到它不管，相当于广播找人。找不找的到它不管。

## tcp的三次握手与四次挥手
在通信这一块，谁发起通信谁是客户端。

发起请求和断开连接请求都是客户端发起的

双向通信  

三次握手就是tcp建立链接时的通信

- 1.客户端发送链接请求（syn）同时发送一个seq顺序号

- 2.服务器发送连接请求响应客户端的连接请求（syn） 和一个顺序号seq以及一个应答号（客户端发过来的顺序号加一）是放在一个包里的

- 3.客户端表示收到服务器的请求发送一个应答号（服务器的顺序号加一）

- 4.连接成功

开始数据传输（来来回回n次）顺序号与应答号一直叠加

四次挥手就是断开连接的通信（）

- 客户端发送服务情请求断开连接的包，并且询问通知服务器要断开请求，询问活干完没，一个顺序号。
- 服务器 发送一个收到请求的应答号的包，然后检查一下工作是否完成，向客户端发送一个断开确认的包，顺序号。
- 收到断开确认包后，向服务器发送断开确认的包，应答号。

> 双向双工通信，单向单工通信

单向 一个端只能向另一端发送，但不能接受，即一段只有发送工具，一端只有接受的功能。

双向：俩端可以互相传。

单工：如果是双向通信的话，当一方在向另一方发送，另一方不能向对方发送数据

双工：如果是双向通信的话，当一方在向另一方发送，另一方可以同时向对方发送数据，

对讲机是单工双向通信；

电话是双工通信

##  CDN概念

![](cdn.png)

图一：集中式（传统的网络）必须从一台服务器上请求

带宽，距离，一个服务器造成延迟与服务器压力问题

图二：cdn模式（讲求近就原则）

即产生多个镜像服务器，解决了服务器压力以及延迟

##  缓存机制

缓存会根据请求保存输出内容的副本，例如html页面，图片，文件，当下一个请求来到的时候:如果是相同的URL，缓存直接使用副本响应访问请求，而不是向源服务器再次发送请求。

缓存的优点： 
- 减少相应延迟，提高响应速度
- 减少网络带宽消耗

![](缓存机制.png)






























