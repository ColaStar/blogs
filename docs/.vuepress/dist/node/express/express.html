<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.js Express 框架</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.3e9a3537.css" as="style"><link rel="preload" href="/assets/js/app.8af69535.js" as="script"><link rel="preload" href="/assets/js/2.d648d88f.js" as="script"><link rel="preload" href="/assets/js/77.931da172.js" as="script"><link rel="prefetch" href="/assets/js/10.97610f94.js"><link rel="prefetch" href="/assets/js/11.59159f0c.js"><link rel="prefetch" href="/assets/js/12.efe3f21c.js"><link rel="prefetch" href="/assets/js/13.4a4c78f6.js"><link rel="prefetch" href="/assets/js/14.9b72df4f.js"><link rel="prefetch" href="/assets/js/15.3a6d7ce1.js"><link rel="prefetch" href="/assets/js/16.eac41172.js"><link rel="prefetch" href="/assets/js/17.b13e21b8.js"><link rel="prefetch" href="/assets/js/18.5f5840be.js"><link rel="prefetch" href="/assets/js/19.3c8bc831.js"><link rel="prefetch" href="/assets/js/20.2fd802c3.js"><link rel="prefetch" href="/assets/js/21.fe1c3bc8.js"><link rel="prefetch" href="/assets/js/22.b8dff5d8.js"><link rel="prefetch" href="/assets/js/23.4e04791f.js"><link rel="prefetch" href="/assets/js/24.48f5c1ac.js"><link rel="prefetch" href="/assets/js/25.c582d482.js"><link rel="prefetch" href="/assets/js/26.5548d10a.js"><link rel="prefetch" href="/assets/js/27.78bcd32b.js"><link rel="prefetch" href="/assets/js/28.2b769fda.js"><link rel="prefetch" href="/assets/js/29.82f7b390.js"><link rel="prefetch" href="/assets/js/3.06e36435.js"><link rel="prefetch" href="/assets/js/30.0f65a25c.js"><link rel="prefetch" href="/assets/js/31.572dbd84.js"><link rel="prefetch" href="/assets/js/32.dc820faa.js"><link rel="prefetch" href="/assets/js/33.c4d79304.js"><link rel="prefetch" href="/assets/js/34.8a5f4a08.js"><link rel="prefetch" href="/assets/js/35.2c795c98.js"><link rel="prefetch" href="/assets/js/36.789c9c9e.js"><link rel="prefetch" href="/assets/js/37.3b778f0f.js"><link rel="prefetch" href="/assets/js/38.6d1dd60a.js"><link rel="prefetch" href="/assets/js/39.cf555500.js"><link rel="prefetch" href="/assets/js/4.84833d8d.js"><link rel="prefetch" href="/assets/js/40.38d7da84.js"><link rel="prefetch" href="/assets/js/41.4eaa1dc4.js"><link rel="prefetch" href="/assets/js/42.5c79ceb8.js"><link rel="prefetch" href="/assets/js/43.58226bd6.js"><link rel="prefetch" href="/assets/js/44.722d8e47.js"><link rel="prefetch" href="/assets/js/45.8c4a2969.js"><link rel="prefetch" href="/assets/js/46.e4e5942d.js"><link rel="prefetch" href="/assets/js/47.e571d66e.js"><link rel="prefetch" href="/assets/js/48.3779b538.js"><link rel="prefetch" href="/assets/js/49.b62a8e2a.js"><link rel="prefetch" href="/assets/js/5.751146ce.js"><link rel="prefetch" href="/assets/js/50.840600be.js"><link rel="prefetch" href="/assets/js/51.907d2772.js"><link rel="prefetch" href="/assets/js/52.be2fc8cd.js"><link rel="prefetch" href="/assets/js/53.32c22580.js"><link rel="prefetch" href="/assets/js/54.7c74f55b.js"><link rel="prefetch" href="/assets/js/55.67be651f.js"><link rel="prefetch" href="/assets/js/56.3d130b37.js"><link rel="prefetch" href="/assets/js/57.c0e4f872.js"><link rel="prefetch" href="/assets/js/58.64090566.js"><link rel="prefetch" href="/assets/js/59.35dd6971.js"><link rel="prefetch" href="/assets/js/6.8e7ccfda.js"><link rel="prefetch" href="/assets/js/60.482cf2bf.js"><link rel="prefetch" href="/assets/js/61.a19ad285.js"><link rel="prefetch" href="/assets/js/62.7b18e1a1.js"><link rel="prefetch" href="/assets/js/63.5c77d49e.js"><link rel="prefetch" href="/assets/js/64.dd4fb2a7.js"><link rel="prefetch" href="/assets/js/65.48fd33a6.js"><link rel="prefetch" href="/assets/js/66.0d04e98a.js"><link rel="prefetch" href="/assets/js/67.07ba1b61.js"><link rel="prefetch" href="/assets/js/68.2fb5db48.js"><link rel="prefetch" href="/assets/js/69.61df01c4.js"><link rel="prefetch" href="/assets/js/7.df0e3edb.js"><link rel="prefetch" href="/assets/js/70.199971e9.js"><link rel="prefetch" href="/assets/js/71.d7777450.js"><link rel="prefetch" href="/assets/js/72.4d262caf.js"><link rel="prefetch" href="/assets/js/73.1924c279.js"><link rel="prefetch" href="/assets/js/74.f907ae48.js"><link rel="prefetch" href="/assets/js/75.7d8db399.js"><link rel="prefetch" href="/assets/js/76.5d637a94.js"><link rel="prefetch" href="/assets/js/78.27b3debd.js"><link rel="prefetch" href="/assets/js/79.86a40c03.js"><link rel="prefetch" href="/assets/js/8.58e59b8f.js"><link rel="prefetch" href="/assets/js/80.42daa631.js"><link rel="prefetch" href="/assets/js/81.2eb1325e.js"><link rel="prefetch" href="/assets/js/82.5fb6983f.js"><link rel="prefetch" href="/assets/js/83.482a58ff.js"><link rel="prefetch" href="/assets/js/84.f4b8414f.js"><link rel="prefetch" href="/assets/js/85.1c79c80f.js"><link rel="prefetch" href="/assets/js/86.4eae8bf0.js"><link rel="prefetch" href="/assets/js/87.b3991055.js"><link rel="prefetch" href="/assets/js/88.24233d08.js"><link rel="prefetch" href="/assets/js/89.7e4bb512.js"><link rel="prefetch" href="/assets/js/9.f8806773.js"><link rel="prefetch" href="/assets/js/90.a767744f.js"><link rel="prefetch" href="/assets/js/91.653caad6.js"><link rel="prefetch" href="/assets/js/92.7fe1d11c.js"><link rel="prefetch" href="/assets/js/93.793830f9.js"><link rel="prefetch" href="/assets/js/94.a55f0129.js"><link rel="prefetch" href="/assets/js/95.17c4d61f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3e9a3537.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="node-js-express-框架"><a href="#node-js-express-框架" aria-hidden="true" class="header-anchor">#</a> Node.js Express 框架</h1> <ul><li>express简介</li> <li>安装express</li> <li>请求与响应</li> <li>路由</li> <li>处理静态文件</li> <li>文件上传</li> <li>GET与POST</li> <li>Cookie 管理</li></ul> <h2 id="express简介"><a href="#express简介" aria-hidden="true" class="header-anchor">#</a> express简介</h2> <p>Express 是一个简洁而灵活的 node.js Web应用框架, 提供了一系列强大特性帮助你创建各种 Web 应用，和丰富的 HTTP 工具。</p> <p>使用 Express 可以快速地搭建一个完整功能的网站。</p> <p>Express 框架核心特性：</p> <ul><li><p>可以设置中间件来响应 HTTP 请求。</p></li> <li><p>定义了路由表用于执行不同的 HTTP 请求动作。</p></li> <li><p>可以通过向模板传递参数来动态渲染 HTML 页面。</p></li></ul> <h2 id="安装-express"><a href="#安装-express" aria-hidden="true" class="header-anchor">#</a> 安装 Express</h2> <p>安装 Express 并将其保存到依赖列表中：</p> <div class="language- extra-class"><pre class="language-text"><code>$ cnpm install express --save
</code></pre></div><p>以上命令会将 Express 框架安装在当前目录的 <code>node_modules</code> 目录中， <code>node_modules</code>目录下会自动创建 express 目录。以下几个重要的模块是需要与 express 框架一起安装的：</p> <ul><li><p>body-parser - node.js 中间件，用于处理 JSON, Raw, Text 和 URL 编码的数据。</p></li> <li><p>cookie-parser - 这就是一个解析Cookie的工具。通过req.cookies可以取到传过来的cookie，并把它们转成对象。</p></li> <li><p>multer - node.js 中间件，用于处理 enctype=&quot;multipart/form-data&quot;（设置表单的MIME编码）的表单数据。</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>$ cnpm install body-parser --save
$ cnpm install cookie-parser --save
$ cnpm install multer --save
</code></pre></div><p>安装完后，我们可以查看下 express 使用的版本号：</p> <div class="language- extra-class"><pre class="language-text"><code>$ cnpm list express
/data/www/node
└── express@4.15.2  -&gt; /Users/tianqixin/www/node/node_modules/.4.15.2@express
</code></pre></div><blockquote><p>第一个 Express 框架实例
接下来我们使用 Express 框架来输出 &quot;Hello World&quot;。</p></blockquote> <p>以下实例中我们引入了 express 模块，并在客户端发起请求后，响应 &quot;Hello World&quot; 字符串。</p> <p>创建 express_demo.js 文件，代码如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>//express_demo.js 文件
var express = require('express');
var app = express();
 
app.get('/', function (req, res) {
   res.send('Hello World');
})
 
var server = app.listen(8081, function () {
 
  var host = server.address().address
  var port = server.address().port
 
  console.log(&quot;应用实例，访问地址为 http://%s:%s&quot;, host, port)
 
})
</code></pre></div><p>执行以上代码：</p> <div class="language- extra-class"><pre class="language-text"><code>$ node express_demo.js 
</code></pre></div><p>应用实例，访问地址为 http://0.0.0.0:8081
在浏览器中访问 http://127.0.0.1:8081，结果如下图所示：</p> <h2 id="请求和响应"><a href="#请求和响应" aria-hidden="true" class="header-anchor">#</a> 请求和响应</h2> <p><code>Express</code> 应用使用回调函数的参数： <code>request</code> 和 <code>response</code> 对象来处理请求和响应的数据。</p> <div class="language- extra-class"><pre class="language-text"><code>app.get('/', function (req, res) {
   // --
})
</code></pre></div><p><code>request</code> 和 <code>response</code> 对象的具体介绍：</p> <blockquote><p><code>Request</code> 对象 - <code>request</code> 对象表示 <code>HTTP</code> 请求，<strong>包含了请求查询字符串，参数，内容，HTTP 头部等属性</strong>。常见属性有：</p></blockquote> <ul><li>req.app：当callback为外部文件时，用req.app访问express的实例</li> <li>req.baseUrl：获取路由当前安装的URL路径</li> <li>req.body / req.cookies：获得「请求主体」/ Cookies</li> <li>req.fresh / req.stale：判断请求是否还「新鲜」</li> <li>req.hostname / req.ip：获取主机名和IP地址</li> <li>req.originalUrl：获取原始请求URL</li> <li>req.params：获取路由的parameters</li> <li>req.path：获取请求路径</li> <li>req.protocol：获取协议类型</li> <li>req.query：获取URL的查询参数串</li> <li>req.route：获取当前匹配的路由</li> <li>req.subdomains：获取子域名</li> <li>req.accepts()：检查可接受的请求的文档类型</li> <li>req.acceptsCharsets / req.acceptsEncodings / req.acceptsLanguages：返回指定字符集的第一个可接受字符编码</li> <li>req.get()：获取指定的HTTP请求头</li> <li>req.is()：判断请求头Content-Type的MIME类型</li></ul> <blockquote><p><code>Response</code> 对象 - <code>response</code> 对象表示 <code>HTTP</code> 响应，即在<strong>接收到请求时向客户端发送的</strong>
HTTP 响应数据。常见属性有：</p></blockquote> <ul><li>res.app：同req.app一样</li> <li>res.append()：追加指定HTTP头</li> <li>res.set()在res.append()后将重置之前设置的头</li> <li>res.cookie(name，value [，option])：设置Cookie
opition: domain / expires / httpOnly / maxAge / path / secure / signed</li> <li>res.clearCookie()：清除Cookie</li> <li>res.download()：传送指定路径的文件</li> <li>res.get()：返回指定的HTTP头</li> <li>res.json()：传送JSON响应</li> <li>res.jsonp()：传送JSONP响应</li> <li>res.location()：只设置响应的Location HTTP头，不设置状态码或者close response</li> <li>res.redirect()：设置响应的Location HTTP头，并且设置状态码302</li> <li>res.render(view,[locals],callback)：渲染一个view，同时向callback传递渲染后的字符串，如果在渲染过程中有错误发生next(err)将会被自动调用。callback将会被传入一个可能发生的错误以及渲染后的页面，这样就不会自动输出了。</li> <li>res.send()：传送HTTP响应</li> <li>res.sendFile(path [，options] [，fn])：传送指定路径的文件 -会自动根据文件extension设定Content-Type</li> <li>res.set()：设置HTTP头，传入object可以一次设置多个头</li> <li>res.status()：设置HTTP状态码</li> <li>res.type()：设置Content-Type的MIME类型</li></ul> <hr> <h2 id="路由"><a href="#路由" aria-hidden="true" class="header-anchor">#</a> 路由</h2> <p>我们已经了解了 HTTP 请求的基本应用，而路由决定了由谁(指定脚本)去响应客户端请求。</p> <p>在HTTP请求中，我们可以通过路由提取出请求的URL以及GET/POST参数。</p> <p>接下来我们扩展 Hello World，添加一些功能来处理更多类型的 HTTP 请求。</p> <p>创建 express_demo2.js 文件，代码如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>express_demo2.js 文件代码：
var express = require('express');
var app = express();
 
//  主页输出 &quot;Hello World&quot;
app.get('/', function (req, res) {
   console.log(&quot;主页 GET 请求&quot;);
   res.send('Hello GET');
})
 
 
//  POST 请求
app.post('/', function (req, res) {
   console.log(&quot;主页 POST 请求&quot;);
   res.send('Hello POST');
})
 
//  /del_user 页面响应
app.get('/del_user', function (req, res) {
   console.log(&quot;/del_user 响应 DELETE 请求&quot;);
   res.send('删除页面');
})
 
//  /list_user 页面 GET 请求
app.get('/list_user', function (req, res) {
   console.log(&quot;/list_user GET 请求&quot;);
   res.send('用户列表页面');
})
 
// 对页面 abcd, abxcd, ab123cd, 等响应 GET 请求
app.get('/ab*cd', function(req, res) {   
   console.log(&quot;/ab*cd GET 请求&quot;);
   res.send('正则匹配');
})
 
 
var server = app.listen(8081, function () {
 
  var host = server.address().address
  var port = server.address().port
 
  console.log(&quot;应用实例，访问地址为 http://%s:%s&quot;, host, port)
 
})
</code></pre></div><p>执行以上代码：</p> <div class="language- extra-class"><pre class="language-text"><code>$ node express_demo2.js 
</code></pre></div><p>应用实例，访问地址为 http://0.0.0.0:8081
接下来你可以尝试访问 http://127.0.0.1:8081 不同的地址，查看效果。</p> <p>在浏览器中访问 http://127.0.0.1:8081/list_user，结果如下图所示：</p> <p><a data-fancybox="" title="" href="https://www.runoob.com/wp-content/uploads/2015/09/express2.jpg"><img src="https://www.runoob.com/wp-content/uploads/2015/09/express2.jpg" alt=""></a></p> <p>在浏览器中访问 http://127.0.0.1:8081/abcd，结果如下图所示：</p> <p><a data-fancybox="" title="" href="https://www.runoob.com/wp-content/uploads/2015/09/express1.jpg"><img src="https://www.runoob.com/wp-content/uploads/2015/09/express1.jpg" alt=""></a>
在浏览器中访问 http://127.0.0.1:8081/abcdefg，结果如下图所示：
<a data-fancybox="" title="" href="https://www.runoob.com/wp-content/uploads/2015/09/express3.jpg"><img src="https://www.runoob.com/wp-content/uploads/2015/09/express3.jpg" alt=""></a></p> <h2 id="静态文件"><a href="#静态文件" aria-hidden="true" class="header-anchor">#</a> 静态文件</h2> <p>Express 提供了内置的中间件 <code>express.static</code> 来设置静态文件如：图片， CSS, JavaScript 等。</p> <p>你可以使用 express.static 中间件来设置静态文件路径。例如，如果你将图片， CSS, JavaScript 文件放在 public 目录下，你可以这么写：</p> <div class="language- extra-class"><pre class="language-text"><code>app.use('/public', express.static('public'));
</code></pre></div><p>我们可以到 public/images 目录下放些图片,如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>node_modules
server.js
public/
public/images
public/images/logo.png
</code></pre></div><p>让我们再修改下 &quot;Hello World&quot; 应用添加处理静态文件的功能。</p> <p>创建 express_demo3.js 文件，代码如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>express_demo3.js 文件代码：
var express = require('express');
var app = express();
 
app.use('/public', express.static('public'));
 
app.get('/', function (req, res) {
   res.send('Hello World');
})
 
var server = app.listen(8081, function () {
 
  var host = server.address().address
  var port = server.address().port
 
  console.log(&quot;应用实例，访问地址为 http://%s:%s&quot;, host, port)
 
})
</code></pre></div><p>执行以上代码：</p> <div class="language- extra-class"><pre class="language-text"><code>$ node express_demo3.js 
应用实例，访问地址为 http://0.0.0.0:8081
</code></pre></div><p>执行以上代码：</p> <p>在浏览器中访问 http://127.0.0.1:8081/public/images/logo.png</p> <h2 id="get-方法"><a href="#get-方法" aria-hidden="true" class="header-anchor">#</a> GET 方法</h2> <p>以下实例演示了在表单中通过 GET 方法提交两个参数，我们可以使用 server.js 文件内的 process_get 路由器来处理输入：</p> <p>index.htm 文件代码：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;html&gt;
&lt;body&gt;
&lt;form action=&quot;http://127.0.0.1:8081/process_get&quot; method=&quot;GET&quot;&gt;
First Name: &lt;input type=&quot;text&quot; name=&quot;first_name&quot;&gt;  &lt;br&gt;
 
Last Name: &lt;input type=&quot;text&quot; name=&quot;last_name&quot;&gt;
&lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p>server.js 文件代码：</p> <div class="language- extra-class"><pre class="language-text"><code>var express = require('express');
var app = express();
 
app.use('/public', express.static('public'));
 
app.get('/index.htm', function (req, res) {
   res.sendFile( __dirname + &quot;/&quot; + &quot;index.htm&quot; );
})
 
app.get('/process_get', function (req, res) {
 
   // 输出 JSON 格式
   var response = {
       &quot;first_name&quot;:req.query.first_name,
       &quot;last_name&quot;:req.query.last_name
   };
   console.log(response);
   res.end(JSON.stringify(response));
})
 
var server = app.listen(8081, function () {
 
  var host = server.address().address
  var port = server.address().port
 
  console.log(&quot;应用实例，访问地址为 http://%s:%s&quot;, host, port)
 
})
</code></pre></div><p>执行以上代码：</p> <div class="language- extra-class"><pre class="language-text"><code>node server.js 
</code></pre></div><p>应用实例，访问地址为 http://0.0.0.0:8081
浏览器访问 http://127.0.0.1:8081/index.htm，如图所示：</p> <p><a data-fancybox="" title="" href="https://www.runoob.com/wp-content/uploads/2015/09/express5.jpg"><img src="https://www.runoob.com/wp-content/uploads/2015/09/express5.jpg" alt=""></a>
现在你可以向表单输入数据，并提交，如下演示：
<a data-fancybox="" title="" href="https://www.runoob.com/wp-content/uploads/2015/09/nodejs-gif6.gif"><img src="https://www.runoob.com/wp-content/uploads/2015/09/nodejs-gif6.gif" alt=""></a></p> <h2 id="post-方法"><a href="#post-方法" aria-hidden="true" class="header-anchor">#</a> POST 方法</h2> <p>以下实例演示了在表单中通过 POST 方法提交两个参数，我们可以使用 server.js 文件内的 process_post 路由器来处理输入：</p> <p>index.htm 文件代码：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;html&gt;
&lt;body&gt;
&lt;form action=&quot;http://127.0.0.1:8081/process_post&quot; method=&quot;POST&quot;&gt;
First Name: &lt;input type=&quot;text&quot; name=&quot;first_name&quot;&gt;  &lt;br&gt;
 
Last Name: &lt;input type=&quot;text&quot; name=&quot;last_name&quot;&gt;
&lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p>server.js 文件代码：</p> <div class="language- extra-class"><pre class="language-text"><code>var express = require('express');
var app = express();
var bodyParser = require('body-parser');
 
// 创建 application/x-www-form-urlencoded 编码解析
var urlencodedParser = bodyParser.urlencoded({ extended: false })
 
app.use('/public', express.static('public'));
 
app.get('/index.htm', function (req, res) {
   res.sendFile( __dirname + &quot;/&quot; + &quot;index.htm&quot; );
})
 
app.post('/process_post', urlencodedParser, function (req, res) {
 
   // 输出 JSON 格式
   var response = {
       &quot;first_name&quot;:req.body.first_name,
       &quot;last_name&quot;:req.body.last_name
   };
   console.log(response);
   res.end(JSON.stringify(response));
})
 
var server = app.listen(8081, function () {
 
  var host = server.address().address
  var port = server.address().port
 
  console.log(&quot;应用实例，访问地址为 http://%s:%s&quot;, host, port)
 
})
</code></pre></div><p>执行以上代码：</p> <div class="language- extra-class"><pre class="language-text"><code>$ node server.js
</code></pre></div><p>应用实例，访问地址为 http://0.0.0.0:8081
浏览器访问 http://127.0.0.1:8081/index.htm，如图所示：</p> <p><a data-fancybox="" title="" href="https://www.runoob.com/wp-content/uploads/2015/09/express5.jpg"><img src="https://www.runoob.com/wp-content/uploads/2015/09/express5.jpg" alt=""></a>
现在你可以向表单输入数据，并提交，如下演示：</p> <p><a data-fancybox="" title="" href="https://www.runoob.com/wp-content/uploads/2015/09/nodejs-gif7.gif"><img src="https://www.runoob.com/wp-content/uploads/2015/09/nodejs-gif7.gif" alt=""></a></p> <h2 id="文件上传"><a href="#文件上传" aria-hidden="true" class="header-anchor">#</a> 文件上传</h2> <p>以下我们创建一个用于上传文件的表单，使用 POST 方法，表单 enctype 属性设置为 multipart/form-data。</p> <p>index.htm 文件代码：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;html&gt;
&lt;head&gt;
&lt;title&gt;文件上传表单&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h3&gt;文件上传：&lt;/h3&gt;
选择一个文件上传: &lt;br /&gt;
&lt;form action=&quot;/file_upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
&lt;input type=&quot;file&quot; name=&quot;image&quot; size=&quot;50&quot; /&gt;
&lt;br /&gt;
&lt;input type=&quot;submit&quot; value=&quot;上传文件&quot; /&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p>server.js 文件代码：</p> <div class="language- extra-class"><pre class="language-text"><code>var express = require('express');
var app = express();
var fs = require(&quot;fs&quot;);
 
var bodyParser = require('body-parser');
var multer  = require('multer');
 
app.use('/public', express.static('public'));
app.use(bodyParser.urlencoded({ extended: false }));
app.use(multer({ dest: '/tmp/'}).array('image'));
 
app.get('/index.htm', function (req, res) {
   res.sendFile( __dirname + &quot;/&quot; + &quot;index.htm&quot; );
})
 
app.post('/file_upload', function (req, res) {
 
   console.log(req.files[0]);  // 上传的文件信息
 
   var des_file = __dirname + &quot;/&quot; + req.files[0].originalname;
   fs.readFile( req.files[0].path, function (err, data) {
        fs.writeFile(des_file, data, function (err) {
         if( err ){
              console.log( err );
         }else{
               response = {
                   message:'File uploaded successfully', 
                   filename:req.files[0].originalname
              };
          }
          console.log( response );
          res.end( JSON.stringify( response ) );
       });
   });
})
 
var server = app.listen(8081, function () {
 
  var host = server.address().address
  var port = server.address().port
 
  console.log(&quot;应用实例，访问地址为 http://%s:%s&quot;, host, port)
 
})
</code></pre></div><p>执行以上代码：</p> <div class="language- extra-class"><pre class="language-text"><code>$ node server.js 
</code></pre></div><p>应用实例，访问地址为 http://0.0.0.0:8081
浏览器访问 http://127.0.0.1:8081/index.htm，如图所示：</p> <p><a data-fancybox="" title="" href="https://www.runoob.com/wp-content/uploads/2015/09/express6.jpg"><img src="https://www.runoob.com/wp-content/uploads/2015/09/express6.jpg" alt=""></a>
现在你可以向表单输入数据，并提交，如下演示：
<a data-fancybox="" title="" href="https://www.runoob.com/wp-content/uploads/2015/09/nodejs-gif8.gif"><img src="https://www.runoob.com/wp-content/uploads/2015/09/nodejs-gif8.gif" alt=""></a></p> <h2 id="cookie-管理"><a href="#cookie-管理" aria-hidden="true" class="header-anchor">#</a> Cookie 管理</h2> <p>我们可以使用中间件向 Node.js 服务器发送 cookie 信息，以下代码输出了客户端发送的 cookie 信息：</p> <p>express_cookie.js 文件代码：</p> <div class="language- extra-class"><pre class="language-text"><code>// express_cookie.js 文件
var express      = require('express')
var cookieParser = require('cookie-parser')
var util = require('util');
 
var app = express()
app.use(cookieParser())
 
app.get('/', function(req, res) {
    console.log(&quot;Cookies: &quot; + util.inspect(req.cookies));
})
 
app.listen(8081)
</code></pre></div><p>执行以上代码：</p> <div class="language- extra-class"><pre class="language-text"><code>$ node express_cookie.js 
</code></pre></div><h2 id="express脚手架"><a href="#express脚手架" aria-hidden="true" class="header-anchor">#</a> express脚手架</h2> <p>Express 应用程序生成器
通过应用生成器工具 express-generator 可以快速创建一个应用的骨架。</p> <p>express-generator 包含了 express 命令行工具。通过如下命令即可安装：</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm install express-generator -g
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>-h 参数可以列出所有可用的命令行参数：

$ express -h

  Usage: express [options] [dir]

  Options:

    -h, --help          输出使用方法
        --version       输出版本号
    -e, --ejs           添加对 ejs 模板引擎的支持
        --hbs           添加对 handlebars 模板引擎的支持
        --pug           添加对 pug 模板引擎的支持
    -H, --hogan         添加对 hogan.js 模板引擎的支持
        --no-view       创建不带视图引擎的项目
    -v, --view &lt;engine&gt; 添加对视图引擎（view） &lt;engine&gt; 的支持 (ejs|hbs|hjs|jade|pug|twig|vash) （默认是 jade 模板引擎）
    -c, --css &lt;engine&gt;  添加样式表引擎 &lt;engine&gt; 的支持 (less|stylus|compass|sass) （默认是普通的 css 文件）
        --git           添加 .gitignore
    -f, --force         强制在非空目录下创建
</code></pre></div><p>例如，如下命令创建了一个名称为 myapp 的 Express 应用。此应用将在当前目录下的 myapp 目录中创建，并且设置为使用 Pug 模板引擎（view engine）：</p> <div class="language- extra-class"><pre class="language-text"><code>$ express --view=pug myapp

   create : myapp
   create : myapp/package.json
   create : myapp/app.js
   create : myapp/public
   create : myapp/public/javascripts
   create : myapp/public/images
   create : myapp/routes
   create : myapp/routes/index.js
   create : myapp/routes/users.js
   create : myapp/public/stylesheets
   create : myapp/public/stylesheets/style.css
   create : myapp/views
   create : myapp/views/index.pug
   create : myapp/views/layout.pug
   create : myapp/views/error.pug
   create : myapp/bin
   create : myapp/bin/www
然后安装所有依赖包：

$ cd myapp
$ npm install
在 MacOS 或 Linux 中，通过如下命令启动此应用：

$ DEBUG=myapp:* npm start
在 Windows 中，通过如下命令启动此应用：
</code></pre></div><blockquote><p>set DEBUG=myapp:* &amp; npm start
然后在浏览器中打开 http://localhost:3000/ 网址就可以看到这个应用了。</p></blockquote> <p>通过生成器创建的应用一般都有如下目录结构：</p> <div class="language- extra-class"><pre class="language-text"><code>.
├── app.js
├── bin
│   └── www
├── package.json
├── public
│   ├── images
│   ├── javascripts
│   └── stylesheets
│       └── style.css
├── routes
│   ├── index.js
│   └── users.js
└── views
    ├── error.pug
    ├── index.pug
    └── layout.pug

7 directories, 9 files
</code></pre></div><h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>express中间件是顺序执行，冲第一个中间件执行到最后一个中间件，发起响应。如下图
<a data-fancybox="" title="" href="https://raw.githubusercontent.com/ColaStar/static/master/images/express顺序.png"><img src="https://raw.githubusercontent.com/ColaStar/static/master/images/express%E9%A1%BA%E5%BA%8F.png" alt=""></a></p> <p>在以上express介绍中只是入门的一些知识，更多api的可以前往<a href="http://www.expressjs.com.cn/4x/api.html" target="_blank" rel="noopener noreferrer">官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>查看</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8af69535.js" defer></script><script src="/assets/js/2.d648d88f.js" defer></script><script src="/assets/js/77.931da172.js" defer></script>
  </body>
</html>
